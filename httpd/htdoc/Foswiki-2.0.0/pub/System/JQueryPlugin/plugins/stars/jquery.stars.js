(function(e){var f={split:1,numStars:5,widthStar:16};function d(i,h){var g=this;g.elem=e(i);g.opts=e.extend({},f,h);g.init()}function c(g){return g.constructor===Object}function a(g){return g.constructor===Array}function b(g){return g.constructor===String}d.prototype._toFixed=function(g){g=Number(g);return Number(g.toFixed(this._prec))};d.prototype.init=function(){var h=this,i,g;h.mapping={};if(h.opts.values){if(b(h.opts.values)){h.opts.values=h.opts.values.split(/\s*,\s*/)}else{if(a(h.opts.values)){g=[];e.each(h.opts.values,function(j,k){if(c(k)){for(i in k){h.mapping[k[i]]=i;g.push(k[i])}}else{g.push(k)}});h.opts.values=g}}h.opts.numStars=h.opts.values.length;h.opts.split=1}h.width=h.opts.numStars*h.opts.widthStar;h._prec=0;if(h.opts.split>1){h._prec++}if(h.opts.split>10){h._prec++}if(h.opts.split>100){h._prec++}h.blockMouseMove=false;h.timeoutId=undefined;h.elem.attr("type","hidden");h.container=e("<div />").addClass("jqStarsContainer").insertAfter(h.elem).width(h.width);h.labelElem=e("<span />").addClass("jqStarsLabel").insertAfter(h.container);h.onElem=e("<div />").addClass("jqStarsOn").appendTo(h.container);if(h.elem.is(":disabled")){h.container.addClass("jqStarsReadOnly")}else{h.deleteElem=e("<div />").addClass("jqStarsDelete").insertAfter(h.elem);h.container.on("mousemove",function(j){if(!h.blockMouseMove){h.displayAtIndex((j.clientX-h.container.position().left)/h.opts.widthStar)}});h.container.on("mouseleave",function(){if(h.blockMouseMove){if(typeof(h.timeoutId)!=="undefined"){window.clearTimeout(h.timeoutId)}h.timeoutId=window.setTimeout(function(){h.blockMouseMove=false;h.timeoutId=undefined},1000)}h.display(h.elem.val());h.container.removeClass("jqStarsSelected")});h.container.on("mouseenter",function(){h.blockMouseMove=false});h.container.on("click",function(j){h.displayAtIndex((j.clientX-h.container.position().left)/h.opts.widthStar);h.container.addClass("jqStarsSelected");h.blockMouseMove=true;h.selectAtIndex(h._tmpIndex);return false});h.deleteElem.hover(function(){h.display()},function(){h.display(h.elem.val())});h.deleteElem.on("click",function(){h.select();return false});h.container.on("mousewheel",function(j){var k=1/h.opts.split;if(j.deltaY>0){h._tmpIndex+=k;if(h._tmpIndex>h.opts.numStars){h._tmpIndex=h.opts.numStars}}else{h._tmpIndex-=k;if(h._tmpIndex<0){h._tmpIndex=0}}h._tmpIndex=h._toFixed(h._tmpIndex);h.selectAtIndex(h._tmpIndex);h.container.addClass("jqStarsSelected");h.blockMouseMove=true;return false})}h.select(h.elem.val())};d.prototype.getDisplayVal=function(h){var g=this,i;if(g.opts.values){i=g.opts.values[h-1];if(typeof(g.mapping[i])!=="undefined"){i=g.mapping[i]}}else{i=sprintf("%."+g._prec+"f",h)}return i};d.prototype.displayAtIndex=function(i){var g=this,j,h;if(typeof(i)==="undefined"||i===0){j=0;h=""}else{i=Math.ceil(i*g.opts.split)/g.opts.split;i=g._toFixed(i);j=g.opts.widthStar*i;h=g.getDisplayVal(i)}if(i==g._tmpIndex){return}g.onElem.width(j);g.labelElem.html(h);g._tmpIndex=i;g.elem.trigger("display.stars",i,h)};d.prototype.display=function(i){var g=this,h;if(typeof(i)==="undefined"||i===""||i==0){h=undefined}else{if(typeof(g.opts.values)!=="undefined"){h=g.opts.values.indexOf(i)+1}else{h=i}}g.displayAtIndex(h)};d.prototype.selectAtIndex=function(h){var g=this,i;g._tmpIndex=undefined;if(typeof(h)==="undefined"||h===0){i=""}else{if(typeof(g.opts.values)!=="undefined"){i=g.opts.values[h-1]}else{i=h}}g.displayAtIndex(h);g.elem.val(i)};d.prototype.select=function(h){var g=this;g._tmpIndex=undefined;g.display(h);g.elem.val(h)};e.fn.stars=function(g){return this.each(function(){if(!e.data(this,"_stars")){e.data(this,"_stars",new d(this,g))}})};e(function(){e(".jqStars:not(.jqInitedStars)").livequery(function(){var h=e(this),g=e.extend({},h.data(),h.metadata());h.stars(g).addClass("jqInitedStars")})})})(jQuery);