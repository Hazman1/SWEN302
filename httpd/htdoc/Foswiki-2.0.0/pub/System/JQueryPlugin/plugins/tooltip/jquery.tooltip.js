(function($){var helper={},current,title,tID,recentExtraClass;$.tooltip={blocked:false,defaults:{delay:200,fade:false,showURL:true,extraClass:"",id:"tooltip",top:0,left:0},block:function(){$.tooltip.blocked=!$.tooltip.blocked}};function settings(element){return $.data(element,"tooltip")}function createHelper(settings){if(helper.parent){return}helper.parent=$('<div id="'+settings.id+'"><h3></h3><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide();if($.fn.bgiframe){helper.parent.bgiframe()}helper.title=$("h3",helper.parent);helper.body=$("div.body",helper.parent);helper.url=$("div.url",helper.parent)}function viewport(){return{x:$(window).scrollLeft(),y:$(window).scrollTop(),cx:$(window).width(),cy:$(window).height()}}function update(event){if($.tooltip.blocked){return}if(event&&event.target.tagName=="OPTION"){return}if(current===null){$(document.body).unbind("mousemove",update);return}var tsettings=settings(current);if(!tsettings.track&&helper.parent.is(":visible")){$(document.body).unbind("mousemove",update)}helper.parent.removeClass("viewport-right viewport-bottom");var left=helper.parent[0].offsetLeft;var top=helper.parent[0].offsetTop;if(event){left=event.pageX+tsettings.left;top=event.pageY+tsettings.top;helper.parent.css({left:left,right:"auto",top:top})}var v=viewport(),h=helper.parent[0];if(v.x+v.cx<h.offsetLeft+h.offsetWidth){left-=h.offsetWidth+20+tsettings.left;helper.parent.css({left:left+"px"}).addClass("viewport-right")}if(v.y+v.cy<h.offsetTop+h.offsetHeight){top-=h.offsetHeight+20+tsettings.top;helper.parent.css({top:top+"px"}).addClass("viewport-bottom")}}function show(){var tsettings=settings(current);tID=null;function complete(){helper.parent.show().css("opacity","1.0")}if(tsettings.fade){if(helper.parent.is(":animated")){helper.parent.stop().fadeTo(tsettings.fade,current.tOpacity,complete)}else if(helper.parent.is(":visible")){helper.parent.stop().fadeTo(tsettings.fade,current.tOpacity,complete)}else{helper.parent.stop().fadeIn(tsettings.fade,complete)}}else{complete()}update()}function handle(event){var tsettings=settings(this);helper.parent.stop();if(tsettings.delay&&!helper.parent.is(":animated")){tID=window.setTimeout(show,tsettings.delay)}else{show()}$(document.body).bind("mousemove",update);update(event)}function save(){var tsettings=settings(this);if($.tooltip.blocked||this==current||!this.tooltipText&&!tsettings.bodyHandler){return}current=this;title=this.tooltipText;if(tsettings.bodyHandler){helper.title.hide();var bodyContent=tsettings.bodyHandler.call(this);if(bodyContent.nodeType||bodyContent.jquery){helper.body.empty().append(bodyContent)}else{helper.body.html(bodyContent)}helper.body.show()}else if(tsettings.showBody){var parts=title.split(tsettings.showBody);helper.title.empty();helper.body.empty();if(parts.length>1){helper.title.html(parts.shift()).show();for(var i=0,part;part=parts[i];i++){if(i>0){helper.body.append("<br/>")}helper.body.append(part)}}else{helper.body.html(parts.shift()).show()}helper.body.hideWhenEmpty();helper.title.hideWhenEmpty()}else{helper.title.html(title).show();helper.body.hide()}if(tsettings.showURL&&$(this).url()){helper.url.html($(this).url().replace("http://","")).show()}else{helper.url.hide()}if(recentExtraClass&&recentExtraClass!=tsettings.extraClass){helper.parent.removeClass(recentExtraClass)}helper.parent.addClass(tsettings.extraClass);recentExtraClass=tsettings.extraClass;handle.apply(this,arguments)}function hide(event){var tsettings=settings(this);if($.tooltip.blocked){return}if(tID){window.clearTimeout(tID)}current=null;function complete(){helper.parent.hide().css("opacity","")}if(tsettings.fade){if(helper.parent.is(":animated")){}else{helper.parent.stop().fadeOut(tsettings.fade,complete)}}else{complete()}}$.fn.extend({tooltip:function(settings){settings=$.extend({},$.tooltip.defaults,settings);createHelper(settings);return this.each(function(){$.data(this,"tooltip",settings);this.tOpacity=helper.parent.css("opacity");this.tooltipText=this.title;$(this).removeAttr("title");this.alt=""}).mouseover(save).mouseout(hide).click(hide).bind("keypress",hide)},hideWhenEmpty:function(){return this.each(function(){$(this)[$(this).html()?"show":"hide"]()})},url:function(){return this.attr("href")||this.attr("src")}})})(jQuery);