jQuery(function($){var defaults={mode:"auto",placeholder:"<img src='"+foswiki.getPreference("PUBURLPATH")+"/System/JQueryPlugin/images/spinner.gif' width='16' height='16' />",url:undefined,params:undefined,topic:undefined,section:undefined,select:undefined,effect:"fade",effectspeed:500,effectopts:{},delay:0,onload:function(){},finished:function(){},beforeload:function(){if(typeof this.container!=="undefined"){this.container.css({opacity:.5})}}};function JQLoader(elem,options){var self=this;self.element=elem;self.options=$.extend({},defaults,options);self.init();if(self.options.mode==="auto"){if(self.options.delay){window.setTimeout(function(){self.load()},self.options.delay)}else{self.load()}}}JQLoader.prototype.init=function(){var self=this,$elem=$(self.element);$elem.bind("refresh.jqloader",function(e,opts){$.extend(self.options,opts);self.load()});if(typeof self.options.onload==="function"){$elem.bind("onload.jqloader",function(){self.options.onload.call(self)})}if(typeof self.options.beforeload==="function"){$elem.bind("beforeload.jqloader",function(){self.options.beforeload.call(self)})}if(typeof self.options.finished==="function"){$elem.bind("finished.jqloader",function(){self.options.finished.call(self)})}self.prepareContainer()};JQLoader.prototype.prepareContainer=function(){var self=this,$elem=$(self.element),$placeholder;if(typeof self.options.placeholder!=="undefined"){$placeholder=$(self.options.placeholder).hide();$placeholder.insertBefore($elem);$elem.bind("beforeload.jqloader",function(){$placeholder.show()});$elem.bind("onload.jqloader",function(){$placeholder.hide()});if(self.options.mode!=="auto"){$placeholder.click(function(){$elem.trigger("refresh.jqloader",self)})}}};JQLoader.prototype.load=function(){var self=this,pubUrlPath=foswiki.getPreference("PUBURLPATH"),$elem=$(self.element),web=self.options.web||foswiki.getPreference("WEB"),topic=self.options.topic||foswiki.getPreference("TOPIC"),params=$.extend({skin:"text"},self.options.params);if(typeof self.options.url==="undefined"){self.options.url=foswiki.getScriptUrl("view",web,topic)}if(typeof self.options.section!=="undefined"){params.section=self.options.section}$elem.trigger("beforeload.jqloader",self);if(self.options.url){$.get(self.options.url,params,function(data){if(typeof self.container!=="undefined"){self.container.remove()}if(typeof self.options.select!=="undefined"){data=$(data).find(self.options.select)}data=self.container=$("<div class='jqLoaderContainer' />").append(data).insertAfter($elem);$elem.trigger("onload.jqloader",self);if(typeof self.options.effect!=="undefined"&&self.options.effect!=="show"){self.container.hide();if(self.options.effect==="fade"){self.container.fadeIn(self.options.effectspeed,function(){$elem.trigger("finished.jqloader",self)})}else{self.container.show(self.options.effect,self.options.effectopts,self.options.effectspeed,function(){$elem.trigger("finished.jqloader",self)})}}else{$elem.trigger("finished.jqloader",self)}},"html")}else{throw"error: no url"}};$.fn.jqLoader=function(options){return this.each(function(){if(!$.data(this,"plugin_jqLoader")){$.data(this,"plugin_jqLoader",new JQLoader(this,options))}})};$(".jqLoader:not(.jqLoaderInited)").livequery(function(){var $this=$(this),opts=$.extend({},$this.metadata());$this.addClass("jqLoaderInited").jqLoader(opts)})});