(function(global,jQuery,undefined){"use strict";if(jQuery&&jQuery.render||global.jsviews){return}var versionNumber="v1.0.0-beta",$,jsvStoreName,rTag,rTmplString,indexStr,delimOpenChar0="{",delimOpenChar1="{",delimCloseChar0="}",delimCloseChar1="}",linkChar="^",rPath=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,rParams=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,rNewLine=/[ \t]*(\r\n|\n|\r)/g,rUnescapeQuotes=/\\(['"])/g,rEscapeQuotes=/['"\\]/g,rBuildHash=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,rTestElseIf=/^if\s/,rFirstElem=/<(\w+)[>\s]/,rAttrEncode=/[\x00`><"'&]/g,rIsHtml=/[\x00`><\"'&]/,rHasHandlers=/^on[A-Z]|^convert(Back)?$/,rHtmlEncode=rAttrEncode,autoTmplName=0,viewId=0,charEntities={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},htmlStr="html",tmplAttr="data-jsv-tmpl",$render={},jsvStores={template:{compile:compileTmpl},tag:{compile:compileTag},helper:{},converter:{}},$views={jsviews:versionNumber,settings:function(settings){$extend($viewsSettings,settings);dbgMode($viewsSettings._dbgMode);if($viewsSettings.jsv){$viewsSettings.jsv()}},sub:{View:View,Err:JsViewsError,tmplFn:tmplFn,cvt:convertArgs,parse:parseParams,extend:$extend,syntaxErr:syntaxError,onStore:{},_lnk:retVal,_ths:tagHandlersFromProps},map:dataMap,_cnvt:convertVal,_tag:renderTag,_err:error};function tagHandlersFromProps(tag,tagCtx){for(var prop in tagCtx.props){if(rHasHandlers.test(prop)){tag[prop]=tagCtx.props[prop]}}}function retVal(val){return val}function dbgBreak(val){debugger;return val}function dbgMode(debugMode){$viewsSettings._dbgMode=debugMode;indexStr=debugMode?"Unavailable (nested view): use #getIndex()":"";$tags("dbg",$helpers.dbg=$converters.dbg=debugMode?dbgBreak:retVal)}function JsViewsError(message){this.name=($.link?"JsViews":"JsRender")+" Error";this.message=message||this.name}function $extend(target,source){var name;for(name in source){target[name]=source[name]}return target}function $isFunction(ob){return typeof ob==="function"}(JsViewsError.prototype=new Error).constructor=JsViewsError;function $viewsDelimiters(openChars,closeChars,link){if(!$sub.rTag||openChars){delimOpenChar0=openChars?openChars.charAt(0):delimOpenChar0;delimOpenChar1=openChars?openChars.charAt(1):delimOpenChar1;delimCloseChar0=closeChars?closeChars.charAt(0):delimCloseChar0;delimCloseChar1=closeChars?closeChars.charAt(1):delimCloseChar1;linkChar=link||linkChar;openChars="\\"+delimOpenChar0+"(\\"+linkChar+")?\\"+delimOpenChar1;closeChars="\\"+delimCloseChar0+"\\"+delimCloseChar1;rTag="(?:(?:(\\w+(?=[\\/\\s\\"+delimCloseChar0+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))"+"\\s*((?:[^\\"+delimCloseChar0+"]|\\"+delimCloseChar0+"(?!\\"+delimCloseChar1+"))*?)";$sub.rTag=rTag+")";rTag=new RegExp(openChars+rTag+"(\\/)?|(?:\\/(\\w+)))"+closeChars,"g");rTmplString=new RegExp("<.*>|([^\\\\]|^)[{}]|"+openChars+".*"+closeChars)}return[delimOpenChar0,delimOpenChar1,delimCloseChar0,delimCloseChar1,linkChar]}function getView(inner,type){if(!type){type=inner;inner=undefined}var views,i,l,found,view=this,root=!type||type==="root";if(inner){found=view.type===type?view:undefined;if(!found){views=view.views;if(view._.useKey){for(i in views){if(found=views[i].get(inner,type)){break}}}else{for(i=0,l=views.length;!found&&i<l;i++){found=views[i].get(inner,type)}}}}else if(root){while(view.parent.parent){found=view=view.parent}}else{while(view&&!found){found=view.type===type?view:undefined;view=view.parent}}return found}function getNestedIndex(){var view=this.get("item");return view?view.index:undefined}getNestedIndex.depends=function(){return[this.get("item"),"index"]};function getIndex(){return this.index}getIndex.depends=function(){return["index"]};function getHelper(helper){var wrapped,view=this,ctx=view.linkCtx,res=(view.ctx||{})[helper];if(res===undefined&&ctx&&ctx.ctx){res=ctx.ctx[helper]}if(res===undefined){res=$helpers[helper]}if(res){if($isFunction(res)&&!res._wrp){wrapped=function(){return res.apply(!this||this===global?view:this,arguments)};wrapped._wrp=true;$extend(wrapped,res)}}return wrapped||res}function convertVal(converter,view,tagCtx,onError){var tag,value,boundTag=+tagCtx===tagCtx&&view.tmpl.bnds[tagCtx-1],linkCtx=view.linkCtx;onError=onError!==undefined&&{props:{},args:[onError]};tagCtx=onError||(boundTag?boundTag(view.data,view,$views):tagCtx);value=tagCtx.args[0];if(converter||boundTag){tag=linkCtx&&linkCtx.tag;if(!tag){tag={_:{inline:!linkCtx,bnd:boundTag},tagName:":",cvt:converter,flow:true,tagCtx:tagCtx,_is:"tag"};if(linkCtx){linkCtx.tag=tag;tag.linkCtx=linkCtx;tagCtx.ctx=extendCtx(tagCtx.ctx,linkCtx.view.ctx)}$sub._lnk(tag)}tag._er=onError&&value;tagHandlersFromProps(tag,tagCtx);tagCtx.view=view;tag.ctx=tagCtx.ctx||{};delete tagCtx.ctx;view._.tag=tag;value=convertArgs(tag,tag.convert||converter!=="true"&&converter)[0];value=boundTag&&view._.onRender?view._.onRender(value,view,boundTag):value;view._.tag=undefined}return value!=undefined?value:""}function convertArgs(tag,converter){var tagCtx=tag.tagCtx,view=tagCtx.view,args=tagCtx.args;converter=converter&&(""+converter===converter?view.getRsc("converters",converter)||error("Unknown converter: '"+converter+"'"):converter);args=!args.length&&!tagCtx.index?[view.data]:converter?args.slice():args;if(converter){if(converter.depends){tag.depends=$sub.getDeps(tag.depends,tag,converter.depends,converter)}args[0]=converter.apply(tag,args)}return args}function getResource(resourceType,itemName){var res,store,view=this;while(res===undefined&&view){store=view.tmpl[resourceType];res=store&&store[itemName];view=view.parent}return res||$views[resourceType][itemName]}function renderTag(tagName,parentView,tmpl,tagCtxs,isUpdate,onError){var tag,tags,attr,parentTag,i,l,itemRet,tagCtx,tagCtxCtx,content,tagDef,callInit,mapDef,thisMap,args,props,initialTmpl,ret="",linkCtx=parentView.linkCtx||0,ctx=parentView.ctx,parentTmpl=tmpl||parentView.tmpl,boundTag=+tagCtxs===tagCtxs&&parentTmpl.bnds[tagCtxs-1];if(tagName._is==="tag"){tag=tagName;tagName=tag.tagName;tagCtxs=tag.tagCtxs}tag=tag||linkCtx.tag;onError=onError!==undefined&&(ret+=onError,[{props:{},args:[]}]);tagCtxs=onError||(boundTag?boundTag(parentView.data,parentView,$views):tagCtxs);l=tagCtxs.length;for(i=0;i<l;i++){if(!i&&(!tmpl||!tag)){tagDef=parentView.getRsc("tags",tagName)||error("Unknown tag: {{"+tagName+"}}")}tagCtx=tagCtxs[i];if(!linkCtx.tag||tag._er){content=tagCtx.tmpl;content=tagCtx.content=content&&parentTmpl.tmpls[content-1];$extend(tagCtx,{tmpl:(tag?tag:tagDef).template||content,render:renderContent,index:i,view:parentView,ctx:extendCtx(tagCtx.ctx,ctx)})}if(tmpl=tagCtx.props.tmpl){tmpl=""+tmpl===tmpl?parentView.getRsc("templates",tmpl)||$templates(tmpl):tmpl;tagCtx.tmpl=tmpl}if(!tag){if(tagDef._ctr){tag=new tagDef._ctr;callInit=!!tag.init}else{$sub._lnk(tag={render:tagDef.render})}tag._={inline:!linkCtx};if(linkCtx){linkCtx.tag=tag;tag.linkCtx=linkCtx}if(tag._.bnd=boundTag||linkCtx.fn){tag._.arrVws={}}else if(tag.dataBoundOnly){error("{^{"+tagName+"}} tag must be data-bound")}tag.tagName=tagName;tag.parent=parentTag=ctx&&ctx.tag;tag._is="tag";tag._def=tagDef;tag.tagCtxs=tagCtxs}tagCtx.tag=tag;if(tag.dataMap&&tag.tagCtxs){tagCtx.map=tag.tagCtxs[i].map}if(!tag.flow){tagCtxCtx=tagCtx.ctx=tagCtx.ctx||{};tags=tag.parents=tagCtxCtx.parentTags=ctx&&extendCtx(tagCtxCtx.parentTags,ctx.parentTags)||{};if(parentTag){tags[parentTag.tagName]=parentTag}tags[tag.tagName]=tagCtxCtx.tag=tag}}parentView._.tag=tag;if(!(tag._er=onError)){tagHandlersFromProps(tag,tagCtxs[0]);tag.rendering={};for(i=0;i<l;i++){tagCtx=tag.tagCtx=tag.tagCtxs[i];props=tagCtx.props;args=convertArgs(tag,tag.convert);if(mapDef=props.dataMap||tag.dataMap){if(args.length||props.dataMap){thisMap=tagCtx.map;if(!thisMap||thisMap.src!==args[0]||isUpdate){if(thisMap&&thisMap.src){thisMap.unmap()}thisMap=tagCtx.map=mapDef.map(args[0],props)}args=[thisMap.tgt]}}tag.ctx=tagCtx.ctx;if(!i&&callInit){initialTmpl=tag.template;tag.init(tagCtx,linkCtx,tag.ctx);callInit=undefined;if(tag.template!==initialTmpl){tag._.tmpl=tag.template}if(linkCtx){linkCtx.attr=tag.attr=linkCtx.attr||tag.attr}}itemRet=undefined;if(tag.render){itemRet=tag.render.apply(tag,args)}args=args.length?args:[parentView];itemRet=itemRet!==undefined?itemRet:tagCtx.render(args[0],true)||(isUpdate?undefined:"");ret=ret?ret+(itemRet||""):itemRet}delete tag.rendering}tag.tagCtx=tag.tagCtxs[0];tag.ctx=tag.tagCtx.ctx;if(tag._.inline&&(attr=tag.attr)&&attr!==htmlStr){ret=attr==="text"?$converters.html(ret):""}return boundTag&&parentView._.onRender?parentView._.onRender(ret,parentView,boundTag):ret}function View(context,type,parentView,data,template,key,contentTmpl,onRender){var views,parentView_,tag,self=this,isArray=type==="array",self_={key:0,useKey:isArray?0:1,id:""+viewId++,onRender:onRender,bnds:{}};self.data=data;self.tmpl=template,self.content=contentTmpl;self.views=isArray?[]:{};self.parent=parentView;self.type=type||"top";self._=self_;self.linked=!!onRender;if(parentView){views=parentView.views;parentView_=parentView._;if(parentView_.useKey){views[self_.key="_"+parentView_.useKey++]=self;self.index=indexStr;self.getIndex=getNestedIndex;tag=parentView_.tag;self_.bnd=isArray&&(!tag||!!tag._.bnd&&tag)}else{views.splice(self_.key=self.index=key,0,self)}self.ctx=context||parentView.ctx}else{self.ctx=context}}View.prototype={get:getView,getIndex:getIndex,getRsc:getResource,hlp:getHelper,_is:"view"};function compileChildResources(parentTmpl){var storeName,resources,resourceName,resource,settings,compile,onStore;for(storeName in jsvStores){settings=jsvStores[storeName];if((compile=settings.compile)&&(resources=parentTmpl[storeName+"s"])){for(resourceName in resources){resource=resources[resourceName]=compile(resourceName,resources[resourceName],parentTmpl);if(resource&&(onStore=$sub.onStore[storeName])){onStore(resourceName,resource,compile)}}}}}function compileTag(name,tagDef,parentTmpl){var init,tmpl;if($isFunction(tagDef)){tagDef={depends:tagDef.depends,render:tagDef}}else{if(tagDef.baseTag){tagDef.flow=!!tagDef.flow;tagDef=$extend($extend({},tagDef.baseTag),tagDef)}if((tmpl=tagDef.template)!==undefined){tagDef.template=""+tmpl===tmpl?$templates[tmpl]||$templates(tmpl):tmpl}if(tagDef.init!==false){init=tagDef._ctr=function(){};(init.prototype=tagDef).constructor=init}}if(parentTmpl){tagDef._parentTmpl=parentTmpl}return tagDef}function compileTmpl(name,tmpl,parentTmpl,options){function tmplOrMarkupFromStr(value){if(""+value===value||value.nodeType>0){try{elem=value.nodeType>0?value:!rTmplString.test(value)&&jQuery&&jQuery(global.document).find(value)[0]}catch(e){}if(elem){value=$templates[name=name||elem.getAttribute(tmplAttr)];if(!value){name=name||"_"+autoTmplName++;elem.setAttribute(tmplAttr,name);value=$templates[name]=compileTmpl(name,elem.innerHTML,parentTmpl,options)}elem=undefined}return value}}var tmplOrMarkup,elem;tmpl=tmpl||"";tmplOrMarkup=tmplOrMarkupFromStr(tmpl);options=options||(tmpl.markup?tmpl:{});options.tmplName=name;if(parentTmpl){options._parentTmpl=parentTmpl}if(!tmplOrMarkup&&tmpl.markup&&(tmplOrMarkup=tmplOrMarkupFromStr(tmpl.markup))){if(tmplOrMarkup.fn&&(tmplOrMarkup.debug!==tmpl.debug||tmplOrMarkup.allowCode!==tmpl.allowCode)){tmplOrMarkup=tmplOrMarkup.markup}}if(tmplOrMarkup!==undefined){if(name&&!parentTmpl){$render[name]=function(){return tmpl.render.apply(tmpl,arguments)}}if(tmplOrMarkup.fn||tmpl.fn){if(tmplOrMarkup.fn){if(name&&name!==tmplOrMarkup.tmplName){tmpl=extendCtx(options,tmplOrMarkup)}else{tmpl=tmplOrMarkup}}}else{tmpl=TmplObject(tmplOrMarkup,options);tmplFn(tmplOrMarkup.replace(rEscapeQuotes,"\\$&"),tmpl)}compileChildResources(options);return tmpl}}function dataMap(mapDef){function newMap(source,options){this.tgt=mapDef.getTgt(source,options)}if($isFunction(mapDef)){mapDef={getTgt:mapDef}}if(mapDef.baseMap){mapDef=$extend($extend({},mapDef.baseMap),mapDef)}mapDef.map=function(source,options){return new newMap(source,options)};return mapDef}function TmplObject(markup,options){var htmlTag,wrapMap=$viewsSettings.wrapMap||{},tmpl=$extend({markup:markup,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:fastRender},options);if(!options.htmlTag){htmlTag=rFirstElem.exec(markup);tmpl.htmlTag=htmlTag?htmlTag[1].toLowerCase():""}htmlTag=wrapMap[tmpl.htmlTag];if(htmlTag&&htmlTag!==wrapMap.div){tmpl.markup=$.trim(tmpl.markup)}return tmpl}function registerStore(storeName,storeSettings){function theStore(name,item,parentTmpl){var onStore,compile,itemName,thisStore;if(name&&typeof name==="object"&&!name.nodeType&&!name.markup&&!name.getTgt){for(itemName in name){theStore(itemName,name[itemName],item)}return $views}if(item===undefined){item=name;name=undefined}if(name&&""+name!==name){parentTmpl=item;item=name;name=undefined}thisStore=parentTmpl?parentTmpl[storeNames]=parentTmpl[storeNames]||{}:theStore;compile=storeSettings.compile;if(item===null){name&&delete thisStore[name]}else{item=compile?item=compile(name,item,parentTmpl):item;name&&(thisStore[name]=item)}if(compile&&item){item._is=storeName}if(item&&(onStore=$sub.onStore[storeName])){onStore(name,item,compile)}return item}var storeNames=storeName+"s";$views[storeNames]=theStore;jsvStores[storeName]=storeSettings}function $fastRender(data,context,noIteration){var tmplElem=this.jquery&&(this[0]||error('Unknown template: "'+this.selector+'"')),tmpl=tmplElem.getAttribute(tmplAttr);return fastRender.call(tmpl?$templates[tmpl]:$templates(tmplElem),data,context,noIteration)}function tryFn(tmpl,data,view){if($viewsSettings._dbgMode){try{return tmpl.fn(data,view,$views)}catch(e){return error(e,view)}}return tmpl.fn(data,view,$views)}function fastRender(data,context,noIteration,parentView,key,onRender){var self=this;if(!parentView&&self.fn._nvw&&!$.isArray(data)){return tryFn(self,data,{tmpl:self})}return renderContent.call(self,data,context,noIteration,parentView,key,onRender)}function renderContent(data,context,noIteration,parentView,key,onRender){var i,l,dataItem,newView,childView,itemResult,swapContent,tagCtx,contentTmpl,tag_,outerOnRender,tmplName,tmpl,noViews,self=this,result="";if(!!context===context){noIteration=context;context=undefined}if(key===true){swapContent=true;key=0}if(self.tag){tagCtx=self;self=self.tag;tag_=self._;tmplName=self.tagName;tmpl=tag_.tmpl||tagCtx.tmpl;noViews=self.attr&&self.attr!==htmlStr,context=extendCtx(context,self.ctx);contentTmpl=tagCtx.content;if(tagCtx.props.link===false){context=context||{};context.link=false}parentView=parentView||tagCtx.view;data=arguments.length?data:parentView}else{tmpl=self}if(tmpl){if(!parentView&&data&&data._is==="view"){parentView=data}if(parentView){contentTmpl=contentTmpl||parentView.content;onRender=onRender||parentView._.onRender;if(data===parentView){data=parentView.data}context=extendCtx(context,parentView.ctx)}if(!parentView||parentView.type==="top"){(context=context||{}).root=data}if(!tmpl.fn){tmpl=$templates[tmpl]||$templates(tmpl)}if(tmpl){onRender=(context&&context.link)!==false&&!noViews&&onRender;outerOnRender=onRender;if(onRender===true){outerOnRender=undefined;onRender=parentView._.onRender}context=tmpl.helpers?extendCtx(tmpl.helpers,context):context;if($.isArray(data)&&!noIteration){newView=swapContent?parentView:key!==undefined&&parentView||new View(context,"array",parentView,data,tmpl,key,contentTmpl,onRender);for(i=0,l=data.length;i<l;i++){dataItem=data[i];childView=new View(context,"item",newView,dataItem,tmpl,(key||0)+i,contentTmpl,onRender);itemResult=tryFn(tmpl,dataItem,childView);result+=newView._.onRender?newView._.onRender(itemResult,childView):itemResult}}else{if(parentView||!tmpl.fn._nvw){newView=swapContent?parentView:new View(context,tmplName||"data",parentView,data,tmpl,key,contentTmpl,onRender);if(tag_&&!self.flow){newView.tag=self}}result+=tryFn(tmpl,data,newView)}return outerOnRender?outerOnRender(result,newView):result}}return""}function error(e,view,fallback){var message=$viewsSettings.onError(e,view,fallback);if(""+e===e){throw new $sub.Err(message)}return!view.linkCtx&&view.linked?$converters.html(message):message}function syntaxError(message){error("Syntax error\n"+message)}function tmplFn(markup,tmpl,isLinkExpr,convertBack){function pushprecedingContent(shift){shift-=loc;if(shift){content.push(markup.substr(loc,shift).replace(rNewLine,"\\n"))}}function blockTagCheck(tagName){tagName&&syntaxError('Unmatched or missing tag: "{{/'+tagName+'}}" in template:\n'+markup)}function parseTag(all,bind,tagName,converter,colon,html,comment,codeTag,params,slash,closeBlock,index){if(html){colon=":";converter=htmlStr}slash=slash||isLinkExpr;var pathBindings=(bind||isLinkExpr)&&[[]],props="",args="",ctxProps="",paramsArgs="",paramsProps="",paramsCtxProps="",onError="",useTrigger="",block=!slash&&!colon&&!comment;tagName=tagName||(params=params||"#data",colon);pushprecedingContent(index);loc=index+all.length;if(codeTag){if(allowCode){content.push(["*","\n"+params.replace(rUnescapeQuotes,"$1")+"\n"])}}else if(tagName){if(tagName==="else"){if(rTestElseIf.test(params)){syntaxError('for "{{else if expr}}" use "{{else expr}}"')}pathBindings=current[7];current[8]=markup.substring(current[8],index);current=stack.pop();content=current[2];block=true}if(params){parseParams(params.replace(rNewLine," "),pathBindings,tmpl).replace(rBuildHash,function(all,onerror,isCtx,key,keyToken,keyValue,arg,param){if(arg){args+=keyValue+",";paramsArgs+="'"+param+"',"}else if(isCtx){ctxProps+=key+keyValue+",";paramsCtxProps+=key+"'"+param+"',"}else if(onerror){onError+=keyValue}else{if(keyToken==="trigger"){useTrigger+=keyValue}props+=key+keyValue+",";paramsProps+=key+"'"+param+"',";hasHandlers=hasHandlers||rHasHandlers.test(keyToken)}return""}).slice(0,-1);if(pathBindings&&pathBindings[0]){pathBindings.pop()}}newNode=[tagName,converter||!!convertBack||hasHandlers||"",block&&[],parsedParam(paramsArgs,paramsProps,paramsCtxProps),parsedParam(args,props,ctxProps),onError,useTrigger,pathBindings||0];content.push(newNode);if(block){stack.push(current);current=newNode;current[8]=loc}}else if(closeBlock){blockTagCheck(closeBlock!==current[0]&&current[0]!=="else"&&closeBlock);current[8]=markup.substring(current[8],index);current=stack.pop()}blockTagCheck(!current&&closeBlock);content=current[2]}var result,newNode,hasHandlers,allowCode=tmpl&&tmpl.allowCode,astTop=[],loc=0,stack=[],content=astTop,current=[,,astTop];if(isLinkExpr){markup=delimOpenChar0+markup+delimCloseChar1}blockTagCheck(stack[0]&&stack[0][2].pop()[0]);markup.replace(rTag,parseTag);pushprecedingContent(markup.length);if(loc=astTop[astTop.length-1]){blockTagCheck(""+loc!==loc&&+loc[8]===loc[8]&&loc[0])}if(isLinkExpr){result=buildCode(astTop,markup,isLinkExpr);setPaths(result,astTop[0][7])}else{result=buildCode(astTop,tmpl)}if(result._nvw){result._nvw=!/[~#]/.test(markup)}return result}function setPaths(fn,paths){fn.deps=[];for(var key in paths){if(key!=="_jsvto"&&paths[key].length){fn.deps=fn.deps.concat(paths[key])}}fn.paths=paths}function parsedParam(args,props,ctx){return[args.slice(0,-1),props.slice(0,-1),ctx.slice(0,-1)]}function paramStructure(parts,type){return"\n	"+(type?type+":{":"")+"args:["+parts[0]+"]"+(parts[1]||!type?",\n	props:{"+parts[1]+"}":"")+(parts[2]?",\n	ctx:{"+parts[2]+"}":"")}function parseParams(params,pathBindings,tmpl){function parseTokens(all,lftPrn0,lftPrn,bound,path,operator,err,eq,path2,prn,comma,lftPrn2,apos,quot,rtPrn,rtPrnDot,prn2,space,index,full){operator=operator||"";lftPrn=lftPrn||lftPrn0||lftPrn2;path=path||path2;prn=prn||prn2||"";var expr,isFn,exprFn,fullLength=full.length-1;function parsePath(allPath,not,object,helper,view,viewProperty,pathTokens,leafToken){if(object){if(bindings){if(named==="linkTo"){bindto=pathBindings._jsvto=pathBindings._jsvto||[];bindto.push(path)}if(!named||boundName){bindings.push(path.slice(not.length))}}if(object!=="."){var ret=(helper?'view.hlp("'+helper+'")':view?"view":"data")+(leafToken?(viewProperty?"."+viewProperty:helper?"":view?"":"."+object)+(pathTokens||""):(leafToken=helper?"":view?viewProperty||"":object,""));ret=ret+(leafToken?"."+leafToken:"");return not+(ret.slice(0,9)==="view.data"?ret.slice(5):ret)}}return allPath}if(err&&!aposed&&!quoted){syntaxError(params)}else{if(bindings&&rtPrnDot&&!aposed&&!quoted){if(!named||boundName||bindto){expr=pathStart[parenDepth];if(fullLength>index-expr){expr=full.slice(expr,index+1);rtPrnDot=delimOpenChar1+":"+expr+" onerror=''"+delimCloseChar0;exprFn=tmplLinks[rtPrnDot];if(!exprFn){tmplLinks[rtPrnDot]=true;tmplLinks[rtPrnDot]=exprFn=tmplFn(rtPrnDot,tmpl||bindings,true);exprFn.paths.push({_jsvOb:exprFn})}if(exprFn!==true){(bindto||bindings).push({_jsvOb:exprFn})}}}}return aposed?(aposed=!apos,aposed?all:'"'):quoted?(quoted=!quot,quoted?all:'"'):(lftPrn?(parenDepth++,pathStart[parenDepth]=index++,lftPrn):"")+(space?parenDepth?"":(paramIndex=full.slice(paramIndex,index),named?(named=boundName=bindto=false,"\b"):"\b,")+paramIndex+(paramIndex=index+all.length,bindings&&pathBindings.push(bindings=[]),"\b"):eq?(parenDepth&&syntaxError(params),bindings&&pathBindings.pop(),named=path,boundName=bound,paramIndex=index+all.length,bound&&(bindings=pathBindings[named]=[]),path+":"):path?path.split("^").join(".").replace(rPath,parsePath)+(prn?(fnCall[++parenDepth]=true,path.charAt(0)!=="."&&(pathStart[parenDepth]=index),isFn?"":prn):operator):operator?operator:rtPrn?(fnCall[parenDepth--]=false,rtPrn)+(prn?(fnCall[++parenDepth]=true,prn):""):comma?(fnCall[parenDepth]||syntaxError(params),","):lftPrn0?"":(aposed=apos,quoted=quot,'"'))}}var named,bindto,boundName,quoted,aposed,bindings=pathBindings&&pathBindings[0],paramIndex=0,tmplLinks=tmpl?tmpl.links:bindings&&(bindings.links=bindings.links||{}),fnCall={},pathStart={0:-1},parenDepth=0;return(params+(tmpl?" ":"")).replace(/\)\^/g,").").replace(rParams,parseTokens)}function buildCode(ast,tmpl,isLinkExpr){var i,node,tagName,converter,tagCtx,hasTag,hasEncoder,getsVal,hasCnvt,needView,useCnvt,tmplBindings,pathBindings,params,boundOnErrStart,boundOnErrEnd,tagRender,nestedTmpls,tmplName,nestedTmpl,tagAndElses,content,markup,nextIsElse,oldCode,isElse,isGetVal,tagCtxFn,onError,tagStart,trigger,tmplBindingKey=0,code="",tmplOptions={},l=ast.length;if(""+tmpl===tmpl){tmplName=isLinkExpr?'data-link="'+tmpl.replace(rNewLine," ").slice(1,-1)+'"':tmpl;tmpl=0}else{tmplName=tmpl.tmplName||"unnamed";if(tmpl.allowCode){tmplOptions.allowCode=true}if(tmpl.debug){tmplOptions.debug=true}tmplBindings=tmpl.bnds;nestedTmpls=tmpl.tmpls}for(i=0;i<l;i++){node=ast[i];if(""+node===node){code+='\n+"'+node+'"'}else{tagName=node[0];if(tagName==="*"){code+=";\n"+node[1]+"\nret=ret"}else{converter=node[1];content=node[2];tagCtx=paramStructure(node[3],"params")+"},"+paramStructure(params=node[4]);onError=node[5];trigger=node[6];markup=node[8];if(!(isElse=tagName==="else")){tmplBindingKey=0;if(tmplBindings&&(pathBindings=node[7])){tmplBindingKey=tmplBindings.push(pathBindings)}}if(isGetVal=tagName===":"){if(converter){tagName=converter===htmlStr?">":converter+tagName}}else{if(content){nestedTmpl=TmplObject(markup,tmplOptions);nestedTmpl.tmplName=tmplName+"/"+tagName;buildCode(content,nestedTmpl);nestedTmpls.push(nestedTmpl)}if(!isElse){tagAndElses=tagName;oldCode=code;code=""}nextIsElse=ast[i+1];nextIsElse=nextIsElse&&nextIsElse[0]==="else"}tagStart=onError?";\ntry{\nret+=":"\n+";boundOnErrStart="";boundOnErrEnd="";if(isGetVal&&(pathBindings||trigger||converter&&converter!==htmlStr)){tagCtxFn="return {"+tagCtx+"};";tagRender='c("'+converter+'",view,';tagCtxFn=new Function("data,view,j,u"," // "+tmplName+" "+tmplBindingKey+" "+tagName+"\n"+tagCtxFn);tagCtxFn._er=onError;boundOnErrStart=tagRender+tmplBindingKey+",";boundOnErrEnd=")";tagCtxFn._tag=tagName;if(isLinkExpr){return tagCtxFn}setPaths(tagCtxFn,pathBindings);useCnvt=true}code+=isGetVal?(isLinkExpr?(onError?"\ntry{\n":"")+"return ":tagStart)+(useCnvt?(useCnvt=undefined,needView=hasCnvt=true,tagRender+(pathBindings?(tmplBindings[tmplBindingKey-1]=tagCtxFn,tmplBindingKey):"{"+tagCtx+"}")+")"):tagName===">"?(hasEncoder=true,"h("+params[0]+")"):(getsVal=true,"((v="+params[0]+')!=null?v:"")')):(needView=hasTag=true,"\n{view:view,tmpl:"+(content?nestedTmpls.length:"0")+","+tagCtx+"},");if(tagAndElses&&!nextIsElse){code="["+code.slice(0,-1)+"]";tagRender='t("'+tagAndElses+'",view,this,';if(isLinkExpr||pathBindings){code=new Function("data,view,j,u"," // "+tmplName+" "+tmplBindingKey+" "+tagAndElses+"\nreturn "+code+";");code._er=onError;code._tag=tagName;if(pathBindings){setPaths(tmplBindings[tmplBindingKey-1]=code,pathBindings)}if(isLinkExpr){return code}boundOnErrStart=tagRender+tmplBindingKey+",undefined,";boundOnErrEnd=")"}code=oldCode+tagStart+tagRender+(tmplBindingKey||code)+")";pathBindings=0;tagAndElses=0}if(onError){needView=true;code+=";\n}catch(e){ret"+(isLinkExpr?"urn ":"+=")+boundOnErrStart+"j._err(e,view,"+onError+")"+boundOnErrEnd+";}\n"+(isLinkExpr?"":"ret=ret")}}}}code="// "+tmplName+"\nvar v"+(hasTag?",t=j._tag":"")+(hasCnvt?",c=j._cnvt":"")+(hasEncoder?",h=j.converters.html":"")+(isLinkExpr?";\n":',ret=""\n')+(tmplOptions.debug?"debugger;":"")+code+(isLinkExpr?"\n":";\nreturn ret;");try{code=new Function("data,view,j,u",code)}catch(e){syntaxError("Compiled template code:\n\n"+code+'\n: "'+e.message+'"')}if(tmpl){tmpl.fn=code}if(!needView){code._nvw=true}return code}function extendCtx(context,parentContext){return context&&context!==parentContext?parentContext?$extend($extend({},parentContext),context):context:parentContext&&$extend({},parentContext)}function getCharEntity(ch){return charEntities[ch]||(charEntities[ch]="&#"+ch.charCodeAt(0)+";")}for(jsvStoreName in jsvStores){registerStore(jsvStoreName,jsvStores[jsvStoreName])}var $templates=$views.templates,$converters=$views.converters,$helpers=$views.helpers,$tags=$views.tags,$sub=$views.sub,$viewsSettings=$views.settings;if(jQuery){$=jQuery;$.fn.render=$fastRender;if($.observable){$extend($sub,$.views.sub);$views.map=$.views.map}}else{$=global.jsviews={};$.isArray=Array&&Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"}}$.render=$render;$.views=$views;$.templates=$templates=$views.templates;$viewsSettings({debugMode:dbgMode,delimiters:$viewsDelimiters,onError:function(e,view,fallback){if(view){e=fallback===undefined?"{Error: "+e+"}":$isFunction(fallback)?fallback(e,view):fallback}return e==undefined?"":e},_dbgMode:true});$tags({"else":function(){},"if":{render:function(val){var self=this,ret=self.rendering.done||!val&&(arguments.length||!self.tagCtx.index)?"":(self.rendering.done=true,self.selected=self.tagCtx.index,self.tagCtx.render(self.tagCtx.view,true));return ret},onUpdate:function(ev,eventArgs,tagCtxs){var tci,prevArg,different;for(tci=0;(prevArg=this.tagCtxs[tci])&&prevArg.args.length;tci++){prevArg=prevArg.args[0];different=!prevArg!==!tagCtxs[tci].args[0];if(!this.convert&&!!prevArg||different){return different}}return false},flow:true},"for":{render:function(val){var finalElse,self=this,tagCtx=self.tagCtx,result="",done=0;if(!self.rendering.done){if(finalElse=!arguments.length){val=tagCtx.view.data}if(val!==undefined){result+=tagCtx.render(val,finalElse);done+=$.isArray(val)?val.length:1}if(self.rendering.done=done){self.selected=tagCtx.index}}return result},flow:true},include:{flow:true},"*":{render:retVal,flow:true}});function getTargetProps(source){var key,prop,props=[];if(typeof source==="object"){for(key in source){prop=source[key];if(!prop||!prop.toJSON||prop.toJSON()){if(!$isFunction(prop)){props.push({key:key,prop:prop})}}}}return props}$tags("props",{baseTag:$tags["for"],dataMap:dataMap(getTargetProps)});function htmlEncode(text){return text!=null?rIsHtml.test(text)&&(""+text).replace(rHtmlEncode,getCharEntity)||text:""}$converters({html:htmlEncode,attr:htmlEncode,url:function(text){return text!=undefined?encodeURI(""+text):text===null?text:""}});$viewsDelimiters()})(this,this.jQuery);