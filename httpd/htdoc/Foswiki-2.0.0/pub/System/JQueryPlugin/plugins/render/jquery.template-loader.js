(function($){"use strict";var queue={};function getUniqueTemplateName(){var uid=(new Date).getTime().toString(32),i;for(i=0;i<5;i++){uid+=Math.floor(Math.random()*65535).toString(32)}return"tmpl_"+uid}$.loadTemplate=function(url,opts){opts=opts||{};if(typeof url==="string"){opts.url=url}else if(typeof url==="object"){opts=url}if(typeof opts.url==="undefined"){throw"ERROR: no url specified in loadTemplate"}opts.name=opts.name||opts.url||getUniqueTemplateName();var promise=queue[opts.url];if(typeof promise==="undefined"){queue[opts.url]=promise=$.Deferred(function(dfd){var template=$.templates[opts.name];if(typeof template!=="undefined"&&!opts.force){dfd.resolve(template)}else{$.log("loading template from ",opts.url);$.ajax({url:opts.url}).then(function(data,status,xhr){queue[opts.url]=undefined;template=$.templates(opts.name,data);dfd.resolve(template);return true},function(xhr,status,error){queue[opts.url]=undefined;dfd.reject(xhr);return false})}}).promise()}return promise};$.fn.loadTemplate=function(opts,data){return this.each(function(){var $elem=$(this);$.loadTemplate(opts).done(function(template){$elem.html(template.render(data))})})}})(jQuery);