(function($){"use strict";foswiki.webTopicCreator={parentList:undefined,canSubmit:function($form,shouldConvertInput){var inputName=$("input[name=topic]",$form).val(),re=foswiki.getPreference("NAMEFILTER"),onlyWikiName=false,finalName,feedbackHeader,feedbackText,error,cleanName=foswiki.String.trimSpaces(inputName);if(typeof re==="string"){re=new RegExp(re,"g")}if(inputName.length===0){$("input[type=submit]",$form).addClass("foswikiSubmitDisabled").attr("disabled",true);$(".webTopicCreatorFeedback",$form).html("");$(".webTopicCreatorError",$form).html("");return false}$("input[name=onlywikiname]",$form).each(function(index,el){onlyWikiName=el.checked});if(cleanName.length===0){return false}if(onlyWikiName){cleanName=inputName.replace(re,"");finalName=cleanName.substr(0,1).toLocaleUpperCase()+cleanName.substr(1)}else{cleanName=inputName.replace(re," ");finalName=foswiki.String.capitalize(cleanName);finalName=finalName.replace(/\s+/g,"")}if(shouldConvertInput){$("input[name=topic]",$form).val(finalName)}if(finalName!==inputName){feedbackHeader=foswiki.getPreference("webTopicCreator.nameFeedback");feedbackText=feedbackHeader+"<strong>"+finalName+"</strong>";$(".webTopicCreatorFeedback",$form).html(feedbackText)}else{$(".webTopicCreatorFeedback",$form).html("");$(".webTopicCreatorError",$form).html("")}if(foswiki.String.isWikiWord(finalName)||!onlyWikiName){$("input[type=submit]",$form).removeClass("foswikiSubmitDisabled").attr("disabled",false);$(".webTopicCreatorError",$form).html("");return true}else{if(finalName.length>3){$(".webTopicCreatorError",$form).html(foswiki.getPreference("webTopicCreator.errorFeedbackNoWikiName"))}}$("input[type=submit]",$form).addClass("foswikiSubmitDisabled").attr("disabled",true);return false},removeSpacesAndPunctuation:function(text){return foswiki.String.removePunctuation(foswiki.String.removeSpaces(text))},filterSpacesAndPunctuation:function(text){return foswiki.String.removeSpaces(foswiki.String.filterPunctuation(text))},loadParentList:function($form,preload){if(this.parentList!==undefined){this.onParentListLoaded($form);return}var parent=$("input[name=topicparent]",$form).val(),url=foswiki.getPreference("SCRIPTURLPATH")+"/view/"+foswiki.getPreference("SYSTEMWEB")+"/ParentList"+"?section=select"+";web="+foswiki.getPreference("WEB")+";cover=text"+";selected="+parent,that=this;$.get(url,function(data){that.parentList=data;if(!preload){that.onParentListLoaded($form)}})},onParentListLoaded:function($form){var parent=$("input[name=topicparent]",$form).val();$("input[name=topicparent]",$form).replaceWith(this.parentList);if(parent){$("select[name=topicparent] option[value="+parent+"]",$form).attr("selected","selected")}this.afterLoadParentList($form)},beforeLoadParentList:function($form){$("img.processing",$form).removeClass("foswikiHidden");$("input[name=topicparent]",$form).attr("readonly","readonly")},afterLoadParentList:function($form){$("img.processing",$form).hide()}};$(function(){$("form[name=newtopicform]").each(function(index,el){var $form=$(el);$("input[name=topic]",$form).each(function(index,el){el.focus()}).keyup(function(e){foswiki.webTopicCreator.canSubmit($form,false)}).change(function(e){foswiki.webTopicCreator.canSubmit($form,false)}).blur(function(e){foswiki.webTopicCreator.canSubmit($form,true)});$("input[name=onlywikiname]",$form).change(function(){foswiki.webTopicCreator.canSubmit($form,false)}).mouseup(function(){foswiki.webTopicCreator.canSubmit($form,false)});$("a.pickparent",$form).click(function(e){$(this).hide();foswiki.webTopicCreator.beforeLoadParentList($form);foswiki.webTopicCreator.loadParentList($form);return false});foswiki.webTopicCreator.canSubmit($form,false);foswiki.webTopicCreator.loadParentList($form,true)}).submit(function(){return foswiki.webTopicCreator.canSubmit(this,true)})})})(jQuery);