<!DOCTYPE html>
<html lang="en">
<head><title>UpgradeGuide</title></head> 
<body class="foswikiNoJs  foswikiHasChangePermission foswikiLoggedIn"><div class="foswikiPage">
<span id="PageTop"></span> 
<h1 id="Foswiki_Upgrade_Guide">  Foswiki Upgrade Guide </h1>
<p></p>
This guide covers upgrading from a previous version of Foswiki to Foswiki 2.0
<p></p>
<!-- Document writers. Please note that this document is distributed in HTML version in the root of the distribution. You cannot use <a href="http://foswiki.org/System/WikiWord">WikiWord</a> links or any other local linking. -->
<p></p>
<div class="foswikiToc" id="foswikiTOC"><span class="foswikiTocTitle">On this page:</span> <ul>
<li> <a href="#Overview"> Overview </a> <ul>
<li> <a href="#Upgrade_requirements"> Upgrade requirements </a>
</li></ul> 
</li> <li> <a href="#Upgrading_to_a_new_patch_release"> Upgrading to a new patch release </a>
</li> <li> <a href="#Upgrade_procedure:_upgrading_to_a_new_major_or_minor_version"> Upgrade procedure: upgrading to a new major or minor version </a> <ul>
<li> <a href="#Before_the_upgrade"> Before the upgrade </a>
</li> <li> <a href="#Prepare_for_all_upgrade_steps"> Prepare for all upgrade steps </a>
</li> <li> <a href="#Installation"> Installation </a>
</li> <li> <a href="#Install_extensions"> Install extensions </a>
</li> <li> <a href="#Copy_parts_of_the_61working_61_directory"> Copy parts of the working directory </a>
</li> <li> <a href="#Copy_the_data_using_61tools_47bulk_copy.pl_61"> Copy the data using tools/bulk_copy.pl </a>
</li> <li> <a href="#Manual_copy_steps_40not_recommended_41"> Manual copy steps (not recommended) </a> <ul>
<li> <a href="#Copy_content_from_non_45default_webs_in_old_installation_to_the_new_installation"> Copy content from non-default webs in old installation to the new installation </a>
</li> <li> <a href="#Copy_users_44_user_topics_44_and_site_customizations_to_61Main_61_web"> Copy users, user topics, and site customizations to Main web </a>
</li></ul> 
</li> <li> <a href="#Convert_empty_DENY_ACLs_to_ALLOW_42_wildcards"> Convert empty DENY ACLs to ALLOW * wildcards </a>
</li> <li> <a href="#Apply_preferences_from_old_installation"> Apply preferences from old installation </a>
</li> <li> <a href="#Apply_additional_site_customizations"> Apply additional site customizations </a> <ul>
<li> <a href="#Modify_skin_with_customizations_for_your_site"> Modify skin with customizations for your site </a>
</li> <li> <a href="#Customize_pages_for_managing_personal_information"> Customize pages for managing personal information </a>
</li></ul> 
</li> <li> <a href="#Validate_your_Wiki_applications_and_other_key_functionality"> Validate your Wiki applications and other key functionality </a>
</li> <li> <a href="#Switch_your_production_site_from_the_old_installation_to_the_new_installation"> Switch your production site from the old installation to the new installation </a>
</li></ul> 
</li></ul> 
</div>
<p></p>
<h2 id="Overview">  Overview </h2>
<p></p>
Foswiki is a fork from TWiki 4.2.3. (TWiki<sup>&reg;</sup> is a trademark of Peter Thoeny.)
Note that newer versions of Foswiki have not directly tracked newer versions of TWiki, and some divergence has occurred. Foswiki 2.0 diverges significantly in some areas.
<p></p>
If you are upgrading from TWiki to Foswiki, please refer to <a class="interwikiLink" href="http://foswiki.org/Support.UpgradingFromOlderTWikiReleases" title="'Support.UpgradingFromOlderTWikiReleases' on foswiki.org">Foswiki:Support.UpgradingFromOlderTWikiReleases</a>.
<p></p>
<h3 id="Upgrade_requirements">  Upgrade requirements </h3> <ul>
<li> Please review the <a class="interwikiLink" href="http://foswiki.org/System.AdminSkillsAssumptions" title="'System.AdminSkillsAssumptions' on foswiki.org">Foswiki:System.AdminSkillsAssumptions</a> before you upgrade your site.
</li> <li> Carefully review <a class="interwikiLink" href="http://foswiki.org/System.SystemRequirements" title="'System.SystemRequirements' on foswiki.org">Foswiki:System.SystemRequirements</a>. Foswiki no longer ships with CPAN libraries. CPAN dependencies must be installed prior to upgrade.
</li> <li> Before upgrading, a backup of your topics is strongly recommended.
</li> <li> Once the upgrade has been applied, an existing earlier installation will still be able to read all the topics, but should not be used to write.
</li></ul> 
<p></p>
<h2 id="Upgrading_to_a_new_patch_release">  Upgrading to a new patch release </h2>
<p></p>
To upgrade to a new patch release &mdash; for example, from Foswiki 1.1.0 to 1.1.2 &mdash; an upgrade package can be used that will not overwrite any of your customizations. We do not recommend upgrading between major or minor versions using the patch (For ex. 1.1.9 to 2.0). A re-installation is recommended.
<p></p>
For patch releases you will find a brief upgrade procedure on the download page for the release. Follow this procedure to upgrade to the patch release. It may contain important steps that are unique to each patch release (for example, some configure settings may need to be changed).
<p></p>
<div class='foswikiHelp'>
 If you use the Foswiki PageCaching feature, be sure to refresh the cache after upgrading to a new Foswiki version. Visit your site with the Query parameter <code>?refresh=all</code>
</div>
<p></p>
<h2 id="Upgrade_procedure:_upgrading_to_a_new_major_or_minor_version">  Upgrade procedure: upgrading to a new major or minor version </h2>
<p></p>
The following is a high level view of the upgrade procedure:
<p></p> <ol>
<li> <strong>Before the upgrade</strong>
</li> <li> <strong>Prepare</strong> for all upgrade steps.
</li> <li> <strong>Install the new Foswiki version</strong> and configure it with the same settings as the old version.<br /> <ul>
<li>  Windows server users: Don't forget to rerun <code>tools/rewriteshebang.pl</code> to fix up the Perl locations
</li></ul> 
</li> <li> <strong>Install any additional extensions</strong> (Plugins) used by your old installation. Make sure to use the latest Foswiki versions.
</li> <li> <strong>Convert all the non-default webs</strong> from the old installation to the new one. (Encoding and Store changes)
</li> <li> <strong>Convert the users, groups, and site customizations</strong> from the old installation to the <code>Main</code> web in the new installation, including all user topics.
</li> <li> <strong>Apply preferences</strong> from the old installation.
</li> <li> <strong>Apply your site customizations</strong>: skin, logos, menu bars, forms for personal information, and so forth.
</li> <li> <strong>Validate your Wiki</strong> applications and other key functionality.
</li> <li> <strong>Switch your production site</strong> from the old installation to the new installation.
</li></ol> 
<p></p>
More details for each step appear in the following sections. The steps may need to be modified or otherwise tailored with specifics for your installation. In particular, you must take care to preserve any special configuration or customizations you have made, especially if you have modified any of the default software files or system topics that are contained within the installation package.
<p></p>
For purposes of discussion, the following conventions are used: <ul>
<li> <code>&lt;oldwiki&gt;</code> refers to the directory in which the old installation is located
</li> <li> <code>&lt;newwiki&gt;</code> refers to the directory in which the new installation is located; it is assumed to be immediately below the root directory of your web server
</li> <li> <code>&lt;old_users_web&gt;</code> refers to the web in which the user topics are located in the old installation. The default value is the <strong>Main</strong> web. The web is specified in the <code>Store settings</code> pane of the <code>configure</code> page, in the <code>{UsersWebName}</code> setting (visible when Expert mode is enabled).
</li> <li> <code>&lt;old_system_web&gt;</code> refers to the web used for documentation and default preferences in the old installation. In <strong>Foswiki</strong>, the default value is the <strong>System</strong> web. The web is specified in the <code>Store settings</code> pane of the <code>configure</code> page, in the <code>{SystemWebName}</code> setting (visible when Expert mode is enabled).
</li></ul> 
<p></p>
After the upgrade, in the new installation, the Main web is used for user topics and site preferences, and the System web is used to hold documentation and default preferences.
<p></p>
The <code>configure</code> page mentioned in this document is accessible via your web browser at <kbd>http://yourdomain/&lt;newwiki&gt;/bin/configure</kbd>&nbsp;.
<p></p>
<h3 id="Before_the_upgrade">  Before the upgrade </h3>
<p></p>
<strong>Managing caches of static <code>.js</code>, <code>.css</code> files</strong>:
<p></p>
If you are using Expires tags, (you should be!) it is very important to take the longest expiration time into consideration. Clients will locally cache JavaScript and CSS until the time expires, unless they clear their cache. <strong>There are significant changes to the JavaScript and CSS files shipped with Foswiki 2.0. Clients using locally cached data will not operate correctly.</strong>
<p></p> <ul>
<li> Prior to the upgrade, reduce the Expires tags to a short duration, for example 1 hour. <ul>
<li> Examine your Apache configuration for statements like: <code>ExpiresDefault "access plus 11 days"</code>, change it to <code>ExpiresDefault "access plus 1 hour"</code>
</li></ul> 
</li> <li> Defer the upgrade until the longest expiration time has passed. If the longest time was 2 weeks, delay the upgrade for 2 weeks.
</li> <li> Complete the upgrade.
</li> <li> Once confident that further upgrades, or fallback are not required, restore the original far future expiration.
</li></ul> 
<p></p>
If these steps are not done, users will have to clear their cache, or "shift-reload" the Foswiki pages to refresh cached information.
<p></p>
<h3 id="Prepare_for_all_upgrade_steps">  Prepare for all upgrade steps </h3>
<p></p>
<strong>Download the Foswiki distribution</strong> from the following location: <a href="http://foswiki.org/Download">http://foswiki.org/Download</a> &mdash; if you are installing your extensions manually, also download them from the repository where they are stored. (Default extensions are included in the Foswiki distribution).
<p></p>
<strong>Review <a class="interwikiLink" href="http://foswiki.org/SystemRequirements" title="'SystemRequirements' on foswiki.org">Foswiki:SystemRequirements</a></strong> and <strong>Install missing Perl modules using your local package manager or CPAN.</strong> Foswiki 2.0 no longer ships with CPAN modules. If you have access to the command line on the server, you can test for missing dependencies by running: <code>perl tools/dependencies</code>
<p></p>
<strong>Review the Release Notes and learn about the differences</strong> between your old installation and the new release to which you are upgrading. Take note of any areas that affect your site and what special steps you may need to take. <ul>
<li> <a class="interwikiLink" href="http://foswiki.org/System.ReleaseNotes01x01" title="'System.ReleaseNotes01x01' on foswiki.org">Foswiki:System.ReleaseNotes01x01</a> if upgrading from a release prior to Foswiki 1.1.9, <em>and</em>
</li> <li> <a class="interwikiLink" href="http://foswiki.org/System.ReleaseNotes01x00" title="'System.ReleaseNotes01x00' on foswiki.org">Foswiki:System.ReleaseNotes01x00</a> if upgrading from an older release of Foswiki 1.0.x
</li></ul> 
<p></p>
<strong>Check that all the extensions (plugins, contribs, skins) used by your old installation are available with the new release.</strong> Familiarize yourself with any new behaviour that you will have to adapt to or any configuration changes you will have to perform.
<p></p> <ul>
<li> <strong>The EditTablePlugin has been deprecated and is not shipped with Foswiki 2.0.</strong> It is replaced by the <a href="http://foswiki.org/System/EditRowPlugin">EditRowPlugin</a>. If you are upgrading an existing site, and have that plugin installed, only one of EditTablePlugin or EditRowPlugin should be enabled.
</li> <li> <strong>Review the deprecated jQuery javascript plugins.</strong> The JQueryPlugin has several changes in available jQuery JavaScript plugins. Determine if any of these will impact your JavaScript enabled topics.
</li></ul> 
<p></p>
<strong>Choose the character encoding to be used in your site.</strong> <ul>
<li> Previous versions of Foswiki defaulted to <code>iso-8859-1</code> encoding (The "Latin Alphabet 1, intended for US and Western European languages).
</li> <li> Foswiki 2.0 defaults to <code>UTF-8</code> encoding, which provides better support for international character sets.
</li></ul> 
<p></p>
You <em>must</em> match the prior encoding, or convert old data to the new encoding if you intend to use topics created on an older version of Foswiki. There are two common use cases: <ul>
<li> Case 1: Your existing site uses the default <code>iso-8859-1</code> or any other common encoding. All topics are consistent with this encoding. You have two options: <ol>
<li> <strong>Recommended</strong>, use the <code>bulk_copy.pl</code> script to migrate your existing 1.1.x store over to Foswiki 2.0. Each topic will be converted from the 1.1.x <code>{Site}{CharSet}</code> encoding to the 2.0 <code>{Store}{Encoding}</code>. We recommend you leave 2.0 <code>{Store}{Encoding}</code> as undefined (<code>utf-8</code>). <strong><em>or</em></strong>
</li> <li> Set the 2.0 <code>{Store}{Encoding}</code> to match your 1.1.x <code>{Site}{Encoding}</code> and copy the data into Foswiki 2.0 unmodified.
</li></ol> 
</li> <li> Case 2: Your site contains a mix of encodings. This can happen if users manually paste in encoded data into topics, or topics are created / modified external to Foswiki. <ul>
<li> In this case, any topics with unusual encodings will display corrupted. Use <a class="interwikiLink" href="http://foswiki.org/Extensions.CharsetConverterContrib" title="'Extensions.CharsetConverterContrib' on foswiki.org">Foswiki:Extensions.CharsetConverterContrib</a> to modify the character encoding of your Foswiki 1.1.x system <em>in place</em>. Changes in character encoding must be done using the RCS based store. When this tool is run with the <code>-r</code> (repair) option, the tool attempts to detect the encoding and can convert individual topics based upon their content. <strong>This is rather unpredictable and may require manual intervention.</strong>
</li> <li> <strong>We *strongly</strong> recommend that a backup be taken before attempting to use the CharsetConverterContrib. As it modifies topics and attachments in-place, it can cause damage and data loss. The recommended <code>bulk_copy.pl</code> script does not modify existing topics.
</li></ul> 
</li></ul> 
<p></p>
<strong>Choose your desired Store.</strong> Foswiki ships with two native stores. <ul>
<li> RcsStoreContrib is compatible with topics created in prior versions of Foswiki.
</li> <li> PlainFileStoreContrib requires that topic histories be converted to a new history format. This can be done at the same time you convert the character set. <code>perl -I lib tools/bulk_copy.pl --help</code> for more information on conversion.
</li></ul> 
<p></p>
<strong>If you are using authentication, prepare a test plan to verify that your authentication mechanism is working correctly.</strong> Make sure you are able to test logins by a sufficient sample of users to cover all categories of users of your site. For example, users of various groups may need to be tested. In particular, ensure you test that non-admin users cannot access topics restricted to admins.
<p></p> <ul>
<li> <strong>Empty DENYTOPICxxxx rules are deprecated</strong> They are disabled by default. We recommend converting any existing rules into <code>&nbsp;&nbsp;&nbsp;* Set ALLOWTOPICxxxx = *</code> wildcard allow rules. Use <code>perl tools/convertTopicSettings.pl -help</code> for further information on the conversion process.
</li></ul> 
<p></p>
<strong>Identify all essential Wiki topics and Wiki applications</strong> that must be fully functional upon completion of the upgrade. Prepare a test plan to verify their functionality. If you are using access controls, ensure that the test plan will adequately test all categories and groups of users of your site.
<p></p>
<strong>If your testing will require a test environment to be set up, ensure that it is ready</strong>, with any required support infrastructure (for example, testbed authentication servers). If you need to be able to login with different users in different categories and groups, ensure that you have the required login information ready, or you have testers from those groups available to perform the required test cases.
<p></p>
<h3 id="Installation">  Installation </h3>
<p></p>
<strong>Follow the installation instructions in INSTALL.html</strong>, located in the root of the new installation. <strong>Install the new release in a new directory.</strong> Do not install on top of the old release. <ul>
<li> For public or otherwise sensitive installations, ensure that your web server configuration is set to deny access to the new Foswiki installation for anyone except you.
</li> <li> <strong>Configure Foswiki</strong> using the <code>configure</code> page. <ul>
<li> <strong>(Not recommended!) If you are upgrading from an older Foswiki release</strong>, first copy your <code>&lt;oldwiki&gt;/lib/LocalSite.cfg</code> file to <code>&lt;newwiki&gt;/lib/LocalSite.cfg</code> in order to preserve your existing configuration settings (Not recommended). Alternatively, you can reconfigure the new installation from scratch (you can use your old <code>LocalSite.cfg</code> file as a reference).
</li> <li> Verify all of the configuration settings on the <code>configure</code> page, including any new settings added in the new version. Save the configuration after you have completed your changes.
</li> <li> To wipe out all your settings and start configuring from a fresh installation, just delete the <code>&lt;newwiki&gt;/lib/LocalSite.cfg</code> file and visit your default <code>view</code> URL. From there follow the link to <code>configure</code>.
</li></ul> 
</li> <li> Additional resources <ul>
<li> <a class="interwikiLink" href="http://foswiki.org/System.InstallationGuide" title="'System.InstallationGuide' on foswiki.org">Foswiki:System.InstallationGuide</a>
</li> <li> <a class="interwikiLink" href="http://foswiki.org/Support.InstallingOnSpecificPlatforms" title="'Support.InstallingOnSpecificPlatforms' on foswiki.org">Foswiki:Support.InstallingOnSpecificPlatforms</a>
</li> <li> <a class="interwikiLink" href="http://foswiki.org/Support.ApacheConfigGenerator" title="'Support.ApacheConfigGenerator' on foswiki.org">Foswiki:Support.ApacheConfigGenerator</a>
</li> <li> <a class="interwikiLink" href="http://foswiki.org/Support.SettingFileAccessRightsLinuxUnix" title="'Support.SettingFileAccessRightsLinuxUnix' on foswiki.org">Foswiki:Support.SettingFileAccessRightsLinuxUnix</a>
</li> <li> <a class="interwikiLink" href="http://foswiki.org/Support.UpgradingFromOlderTWikiReleases" title="'Support.UpgradingFromOlderTWikiReleases' on foswiki.org">Foswiki:Support.UpgradingFromOlderTWikiReleases</a> - upgrading TWiki from older TWiki releases
</li></ul> 
</li></ul> 
<!-- to be included once the supplemental documents are written (also modify the "Related Topics" section at the bottom of this document) <ul>
 <li>
 <ul>
<li> <a class="interwikiLink" href="http://foswiki.org/Support.UpgradingFromTWiki4x2Releases" title="'Support.UpgradingFromTWiki4x2Releases' on foswiki.org">Foswiki:Support.UpgradingFromTWiki4x2Releases</a> - upgrading from TWiki4.2.X to Foswiki
</li> <li> <a class="interwikiLink" href="http://foswiki.org/Support.UpgradingPatchReleases" title="'Support.UpgradingPatchReleases' on foswiki.org">Foswiki:Support.UpgradingPatchReleases</a> - upgrading releases where only last digit in the version changed
</li></ul> 
</li></ul> 
-->
<p></p>
Test your newly-installed Foswiki site and ensure that its basic functionality works: viewing and editing topics (you can try creating and editing a topic in the Sandbox web).
<p></p>
<div class="foswikiHelp"> <strong>Caution:</strong> If you intend to copy data from an older installation without using <code>bulk_copy.pl</code> to change Stores, you should select the RcsStoreContrib in the configuration.
Once topic history has been created with the wrong store, it has to either be removed, or old data should be migrated with <code>bulk_copy.pl</code>.
If Foswiki encounters mixed RCS and PlainFile topic history, it will "die" to prevent topic history corruption.</div>
<p></p>
<div class="foswikiHelp">If you want to run Foswiki 2.0 in parallel with Foswiki 1.1.9, you can do this safely if the following conditions are met: <ul>
<li> The RCS store is used on both installations. (RCSWrap and RCSLite are compatible.
</li> <li> The 2.0 <code>{Store}{Encoding}</code> must match the 1.1.9 <code>{Site}{CharSet}</code>
</li> <li> The 2.0 <code>{AccessControlACL}{EnableDeprecatedEmptyDeny}</code> setting should be enabled.
</li> <li> The 2.0 <code>{Htpasswd}{CharacterEncoding}</code> should match your 1.1.9 <code>{Site}{CharSet}</code>
</li> <li> The 2.0 <code>{RCS}{TabularChangeFormat}</code> should be enabled for compatible .changes file format.
</li></ul> 
</div>
To make it easier to follow the subsequent steps, you can view this upgrade guide using your new Foswiki site by entering <code>System.UpgradeGuide</code> into the "Jump" text box on the top right of any topic. By doing this instead of using the <a class="foswikiCurrentTopicLink" href="http://foswiki.org/System/UpgradeGuide">UpgradeGuide</a>.html file from the distribution, you will be able to use the embedded hyperlinks to jump directly to the referenced pages.
<p></p>
<h3 id="Install_extensions">  Install extensions </h3>
<p></p>
Install all of the extensions that were installed in your old site. In particular, start with any extensions required for the authentication and authorization methods you use (if any). You can use the <em>Install, Update or Remove extensions</em> tab in the <em>Extensions</em> section of the <code>configure</code> page to review installed extensions, search for extensions or all available extensions and configure extensions from the <a class="interwikiLink" href="http://foswiki.org/Extensions" title="'Extensions' on foswiki.org">Foswiki:Extensions</a> repository. You can also install extensions manually; see the instructions on the extension's web page from where you obtained the extension (for Foswiki extensions, on foswiki.org).
<p></p>
Check the plugin topics from your old Foswiki installation and transfer the plugin settings to the <code><a href="http://foswiki.org/Main/SitePreferences">Main.SitePreferences</a></code> topic in your new Foswiki site, prefixing each setting with the name of the plugin in uppercase followed by an underscore. For example, to copy over the <code>DEFAULT_TYPE</code> setting from the <code>CommentPlugin</code> topic in the old site to the new site, copy the value to a <code>COMMENTPLUGIN_DEFAULT_TYPE</code> setting in the <code><a href="http://foswiki.org/Main/SitePreferences">Main.SitePreferences</a></code> topic in the new site.
<p></p>
Commonly-customized plugin settings include the following: <ul>
<li> <code>CommentPlugin</code> - DEFAULT_TYPE
</li> <li> <code>EditTablePlugin</code> <strong>Deprecated! Replaced with <a href="http://foswiki.org/System/EditRowPlugin">EditRowPlugin</a></strong> - CHANGEROWS, QUIETSAVE, EDITBUTTON
</li> <li> <code>InterwikiPlugin</code> - RULESTOPIC
</li> <li> <code>InterWikis</code> - If you added your own rules, make sure you copy over the rules to the new installation. Use of a local rules topic is the preferred way to customize the links.
</li> <li> <code>SlideShowPlugin</code> - If you changed the embedded 'Default Slide Template', then copy your customized template to the topic in the new installation. You should prefer creating your own slide show template in a separate topic, so you will not have to take special steps over upgrades to preserve your modifications to the default slide template.
</li> <li> <code>SmiliesPlugin</code> - If you added your own smileys, make sure you copy over your customizations to the topic in the new installatin.
</li> <li> <code>TablePlugin</code> - TABLEATTRIBUTES
</li></ul> 
<p></p>
Activate, and if required, configure the installed extensions in <code>configure</code>.
<p></p>
<span id="CopyWorkingDirWorkareas"></span>
<h3 id="Copy_parts_of_the_61working_61_directory">  Copy parts of the <code>working</code> directory </h3>
<p></p>
The working directory contains some critical information for some extensions, found below the <code>foswiki/working/work_areas</code> directory.
 Extensions use it to store persistent information critical to operation. For example, the <code>MailerContrib</code> directory contains the timestamps of the last notification email run per web.
If not copied, the next <code>mailnotify</code> run will notify all recorded changes.
This is the most common data that should be copied. Review other non-default extensions to determine if anything else should be copied.
<p></p>
<span id="CopyDataFromOldInstallation"></span>
<h3 id="Copy_the_data_using_61tools_47bulk_copy.pl_61">  Copy the data using <code>tools/bulk_copy.pl</code> </h3>
<p></p>
This is the recommended way to migrate your system. Assume that you have the
following setup: <ul>
<li> Existing: <code>/var/www/f119</code>
</li> <li> New: <code>/var/www/f120</code>
</li></ul> 
Use the <code>bulk_copy.pl</code> tool to migrate your data:
<p></p>
<pre>
cd /var/www/f120/tools
perl bulk&#95;copy.pl --xweb System --xweb &#95;default --xweb &#95;empty --latest &#39;&#42;.WebStatistics&#39; /var/www/f119/bin /var/www/f120/bin
</pre>
<p></p>
This will copy all webs, topics and attachments except for the contents of the
System web. This is the recommended solution.
<p></p>
<h3 id="Manual_copy_steps_40not_recommended_41">  Manual copy steps (not recommended) </h3>
These steps can be used to manually migrate data when not changing the Store
type or encoding.
<p></p>
<div class="twistyPlugin foswikiMakeVisible"><span id="twistyIdSystemUpgradeGuide6354show" style="display:none" class="twistyTrigger foswikiUnvisited twistyInited"><a class="" href="#"><span class="foswikiLinkLabel foswikiUnvisited">Show manual migration steps</span></a></span><span id="twistyIdSystemUpgradeGuide6354hide" style="display:none" class="twistyTrigger foswikiUnvisited twistyInited"><a class="" href="#"><span class="foswikiLinkLabel foswikiUnvisited">Close</span></a></span></div><div class="twistyPlugin"><div id="twistyIdSystemUpgradeGuide6354toggle" style="" class="twistyContent twistyInited">
<div class="foswikiHelp"> Content should be copied using the <code>tools/bulk_copy.pl</code> script. This will allow conversion to <code>utf-8</code> and the PlainFile Store. Only proceed with this step if you will be remaining on the RCS store with your existing character encoding.</div>
<p></p>
<blockquote>
<span id="CopyNonDefaultWebs"></span>
<h4 id="Copy_content_from_non_45default_webs_in_old_installation_to_the_new_installation">  Copy content from non-default webs in old installation to the new installation </h4>
<strong>Be sure to select an "RCS Store" <code>RcsWrap</code> or <code>RcsLite</code> on the new installation.</strong> The PlainFile store is not compatible with topic history written on previous versions of Foswiki. If you have created or updated topics using PlainFileStore, you should either start over, or plan to to remove all <code>,pfv</code> directories from the system so that there is no history in the PlainFileStore format.
<p></p>
<strong>Copy your local webs</strong> over to the data and pub directories of the new installation. Do not copy the default webs: &lt;old_system_web&gt; System, Main, Trash, Sandbox, _default, and _empty. <ul>
<li> Make sure the data and pub directories, as well as the files within them, are readable and writeable by the web server user.
</li> <li> <strong>Note:</strong> Foswiki's <code>WebChanges</code> topics depend on the file timestamp. If you touch the .txt files make sure to preserve the timestamp, or change them in the same chronological order as the old file timestamps.
</li></ul> 
<p></p>
<strong>Verify that existing topics are operational</strong> and (if you converted to <code>UTF-8</code>) that any international characters have been properly converted and are displayed correctly.
<p></p>
<span id="CopyUsersAndCustomizations"></span>
<h4 id="Copy_users_44_user_topics_44_and_site_customizations_to_61Main_61_web">  Copy users, user topics, and site customizations to <code>Main</code> web </h4>
<p></p>
<strong>Copy all topics and attachments from &lt;old_users_web&gt;:</strong> copy all files from <code>&lt;oldwiki&gt;/data/&lt;old_users_web&gt;/</code> to <code>&lt;newwiki&gt;/data/Main/</code>, and copy all files from <code>&lt;oldwiki&gt;/pub/&lt;old_users_web&gt;/</code> to <code>&lt;newwiki&gt;/pub/Main/</code> . <strong>Do not overwrite any topics already present in the <code>&lt;newwiki&gt;/data/Main/</code> directory.</strong> <ul>
<li> In addition to all the user topics, if you have created <code>&lt;old_users_web&gt;.NewUserTemplate</code> in the old installation, this step will copy over your template for user topics to the new installation.
</li> <li> Ensure that the topic defining the admin group in your old installation is copied over. The admin group is defined in the <code>Security setup</code> pane of the <code>configure</code> page, in the <code>{SuperAdminGroup}</code> setting (visible when Expert mode is enabled). You can do either of the following: <ul>
<li> Set the <code>{SuperAdminGroup}</code> setting in your new installation to the old admin group.
</li> <li> Move the contents of the old admin group to the new admin group. To avoid having to change all references to the old admin group, you must still keep the old admin group defined: set it so its only member is the new admin group, and the new admin group is the only user who can change or rename the old admin group topic.
</li></ul> 
</li> <li> If your old installation did not customize <code>{LocalSitePreferences}</code> on the <code>configure</code> page, or if you did customize <code>{LocalSitePreferences}</code> but kept your site preferences within the &lt;old_users_web&gt; web, then this step will also copy over your site preferences to the new installation.
</li></ul> 
<p></p>
<strong>For upgrades from an older Foswiki installation:</strong> <ul>
<li> Manually merge all users from the <code>&lt;old_users_web&gt;.WikiUsers</code> topic in the old installation to the <code>Main.WikiUsers</code> topic in the new installation. If the new installation does not yet have an initial <code>Main.WikiUsers</code> topic, then copy <code>&lt;oldwiki&gt;/data/&lt;old_users_web&gt;/WikiUsers.txt</code> to <code>&lt;newwiki&gt;/data/Main/WikiUsers.txt</code>.
</li> <li> Verify that the following default users are present in the <code>Main.WikiUsers</code> topic: <ul>
<li> <strong>ProjectContributor</strong> - the Foswiki documentation is attributed to this user
</li> <li> <strong>RegistrationAgent</strong> - special user used during the new user registration process
</li> <li> <strong>UnknownUser</strong> - used where the author of a previously stored piece of data can't be determined
</li> <li> <strong>WikiGuest</strong> - guest user; used as a fallback if the user can't be identified
</li></ul> 
</li> <li> If any of the default users are missing, then add them in manually to <code>Main.WikiUsers</code>, using the corresponding entries in <a class="interwikiLink" href="http://foswiki.org/System.UsersTemplate" title="'System.UsersTemplate' on foswiki.org">Foswiki:System.UsersTemplate</a> as an example.
</li> <li> If you use <code>data/.htpasswd</code> for authentication, copy this file from the old installation to the new one.
</li> <li> If you have customized <code>&lt;old_system_web&gt;.UserRegistration</code>, then either copy over <code>&lt;oldwiki&gt;/data/&lt;old_system_web&gt;/UserRegistration.txt</code> and <code>&lt;oldwiki&gt;/data/&lt;old_system_web&gt;/UserRegistration.txt,v</code> to the <code>&lt;newwiki&gt;/data/System/</code> directory, or modify <code>System.UserRegistration</code> in the new installation to contain your customizations.
</li></ul> 
<p></p>
<strong>Copy over any topics and attachments you want to preserve from the Sandbox web</strong> in the old installation: copy the desired files from <code>&lt;oldwiki&gt;/data/Sandbox/</code> to <code>&lt;newwiki&gt;/data/Sandbox</code> and from <code>&lt;oldwiki&gt;/pub/Sandbox/</code> to <code>&lt;newwiki&gt;/pub/Sandbox</code> . Some pages you may wish to preserve are the <code>WebHome</code> topic and the <code>WebLeftBar</code> topic (if you had created it in the old wiki installation). The Sandbox web often contains work-in-progress topics that users will want to keep.
<p></p>
Make sure the data and pub directories, as well as the files within them, are readable and writeable by the web server user.
</blockquote>
</div></div>
<p></p>
<h3 id="Convert_empty_DENY_ACLs_to_ALLOW_42_wildcards">  Convert empty DENY ACLs to ALLOW * wildcards </h3>
<p></p>
By default, empty <code>DENYTOPIC</code> rules will be ignored by Foswiki 2.0.  You must change them to the equivalent <code>ALLOWTOPIC *</code> rules.  The <code>tools/convertTopicSettings.pl</code> utility will scan the Webs &amp; Topics, and will perform several optional conversions on the topics. <dl>
<dt> Get help text for <code>convertTopicSettings</code> </dt><dd> <code>perl tools/convertTopicSettings.pl -help</code>
</dd> <dt> Scan all webs / topics, report any topics with empty DENY rules </dt><dd> <code>perl tools/convertTopicSettings.pl</code>
</dd> <dt> Replace all empty DENY rules with ALLOW * wildcards </dt><dd> <code>perl tools/convertTopicSettings.pl -fixdeny -update</code>
</dd> <dt> Same, but convert all ACLs into META settings from inline topic settings, for just the Sandbox web </dt><dd> <code>perl tools/convertTopicSettings.pl -fixdeny -convert -update Sandbox</code>
</dd> <dt> Convert ALL settings into META settings, not just ACLs, for the Sandbox and Customer webs </dt><dd> <code>perl tools/convertTopicSettings.pl -fixdeny -convert -all -update Sandbox Customer</code>
</dd></dl> 
<p></p>
When <code>convertTopicSettings</code> saves the modified topics, they will be saved by user <em>UnknownUser</em>.
<p></p>
<h3 id="Apply_preferences_from_old_installation">  Apply preferences from old installation </h3>
<p></p>
If you have not already set your desired site-wide preferences, as described in the section " <a href="http://foswiki.org/System/InstallationGuide#SetPreferences">Set Foswiki Preferences</a>" in the <a href="http://foswiki.org/System/InstallationGuide">InstallationGuide</a>, then set your preferences. The location of your site preferences is specified in the <code>Miscellaneous settings</code> pane of the <code>configure</code> page, in the <code>{LocalSitePreferences}</code> setting (visible when Expert mode is enabled) &mdash; the default location is <strong>Main.SitePreferences</strong>. Copy any customized preferences from the site preferences topic in your old installation to the site preferences topic in the new installation. (Note you may have already copied over your customized preferences when you transfered the contents of the &lt;old_users_web&gt; web.)
(These should have been copied when your Main was migrated.)
<p></p>
If, in your old installation, you customized the default preferences in <code>&lt;old_system_web&gt;.DefaultPreferences</code>, then transfer your customizations from this topic to the site preferences topic instead (i.e. the topic specified in your <code>{LocalSitePreferences}</code> setting), so that your customizations will not get overwritten on the next upgrade.
<p></p>
<h3 id="Apply_additional_site_customizations">  Apply additional site customizations </h3>
<p></p>
<h4 id="Modify_skin_with_customizations_for_your_site">  Modify skin with customizations for your site </h4>
<p></p>
If you did not already customize the appearance of your new installation, as described in the section " <a href="http://foswiki.org/System/InstallationGuide#CustomizeAppearance">Customize the appearance of your Foswiki site</a>" in the <a href="http://foswiki.org/System/InstallationGuide">InstallationGuide</a>, then reapply the customizations from your old installation to the new one. Ensure you transfer over any skin templates &mdash; .tmpl files, or topics referred to using VIEW_TEMPLATE or EDIT_TEMPLATE preferences &mdash; you need. Also ensure you transfer any style sheets or Javascript files required.
<p></p>
<h4 id="Customize_pages_for_managing_personal_information">  Customize pages for managing personal information </h4>
<p></p>
In your new installation, default copies of the following topics were installed: <ul>
<li> <code><a href="http://foswiki.org/System/ChangePassword">System.ChangePassword</a></code>
</li> <li> <code><a href="http://foswiki.org/System/ResetPassword">System.ResetPassword</a></code>
</li> <li> <code><a href="http://foswiki.org/System/ChangeEmailAddress">System.ChangeEmailAddress</a></code>
</li></ul> 
<p></p>
If you customized these topics in your old installation, transfer the changes to these topics in the new installation. Use the corresponding files in the <code>&lt;oldwiki&gt;/&lt;old_system_web&gt;/</code> directory as a reference.
<p></p>
<h3 id="Validate_your_Wiki_applications_and_other_key_functionality">  Validate your Wiki applications and other key functionality </h3>
<p></p>
Execute your test plan to validate the Wiki applications and other key functionality that need to be up and running after the upgrade.
<p></p>
<strong>Execute your test plans for authentication and authorization.</strong> Test that users that you have transferred from the old installation can login with any problems, and that access controls work appropriately: check that users are able to view and edit pages for which they have access, and are denied permission to view or edit pages for which they do not have access. Also check that pages restricted to the admin group are not accessible by non-admin users, and that administrators continue to have access.
<p></p>
<p></p>
<h3 id="Switch_your_production_site_from_the_old_installation_to_the_new_installation">  Switch your production site from the old installation to the new installation </h3>
<p></p>
 <strong>If you are converting from RCS to PlainFile store, you must not repeat any copy step from the old to the new version once you've run the conversion.</strong>
<p></p>
If you had been running your old installation in parallel with the new one during a test phase, then disable your old installation, and repeat the steps: <ul>
<li> <a class="foswikiCurrentTopicLink" href="#CopyNonDefaultWebs">Copy content from non-default webs in old installation to the new installation</a>".
</li> <li> <a class="foswikiCurrentTopicLink" href="#CopyWorkingDirWorkareas">Copy extension operational information from working, to the new installation</a>
</li></ul> 
<p></p>
<p></p>
Change your web server configuration so that the new installation is accessible to all of your users, and so the old installation is no longer accessible.
<p></p>
Change your web server configuration so that the new installation is accessible using the same URL prefix as your old installation. For purposes of discussion, assume that your old installation is accessible from <code>http://yourdomain/wiki/</code>. You can use one of the following approaches to make the new installation accessible using the same URL prefix: <ul>
<li> You can rename your <code>&lt;newwiki&gt;/</code> directory to <code>wiki/</code> (renaming the directory of your old installation if necessary).
</li> <li> If your operating system supports links to other directories and your web server is configured to follow links, then you can create a link called <code>wiki/</code> that points to <code>&lt;newwiki&gt;/</code> (renaming the directory of your old installation if necessary).
</li> <li> You can configure your web server so that requests to <code>/wiki/</code> are served from your <code>&lt;newwiki&gt;/</code> directory.
</li></ul> 
<p></p>
Re-execute your test plan to verify that your newly-upgraded site is accessible to your users, and that all authentication and authorization mechanisms work as expected (including denying access to those who are not authorized).
<p></p>
Re-execute your test plan to verify that your Wiki applications and other key functionality work as intended.
<p></p>
<!--  -->
<p></p>
<p></p>
<hr />
<p></p>
<strong>Related Topics:</strong> <a href="http://foswiki.org/System/AdminDocumentationCategory">AdminDocumentationCategory</a>, <a class="interwikiLink" href="http://foswiki.org/Support.InstallationGuide" title="'Support.InstallationGuide' on foswiki.org">Foswiki:Support.InstallationGuide</a>, <a class="interwikiLink" href="http://foswiki.org/Support.InstallingOnSpecificPlatforms" title="'Support.InstallingOnSpecificPlatforms' on foswiki.org">Foswiki:Support.InstallingOnSpecificPlatforms</a>, <a class="interwikiLink" href="http://foswiki.org/Support.ApacheConfigGenerator" title="'Support.ApacheConfigGenerator' on foswiki.org">Foswiki:Support.ApacheConfigGenerator</a>, <a class="interwikiLink" href="http://foswiki.org/Support.SettingFileAccessRightsLinuxUnix" title="'Support.SettingFileAccessRightsLinuxUnix' on foswiki.org">Foswiki:Support.SettingFileAccessRightsLinuxUnix</a>, <a href="http://foswiki.org/System/ReleaseNotes01x00">ReleaseNotes01x00</a>, <a href="http://foswiki.org/System/ReleaseNotes01x01">ReleaseNotes01x01</a>
<span id="TopicEnd"></span>
<p></p>
<p></p>
<p></p>
<p></p>
</div>
</body></html>