# Autogenerated httpd.conf file for Foswiki.
# Generated at #http://foswiki.org/Support/ApacheConfigGenerator24?vhost=;port=;dir=/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0;symlink=;pathurl=matterhorn:8585Foswiki-2.0.0;shorterurls=enabled;engine=CGI;fastcgimodule=fcgid;fcgidreqlen=;apver=2;confighost=;configip=;configuser=;loginmanager=None;htpath=;errordocument=UserRegistration;errorcustom=;phpinstalled=PHP4;blockpubhtml=;blocktrashpub=;controlattach=;blockspiders=;foswikiversion=1.1;apacheversion=2.2;timeout=;ssl=;sslcert=etc/ssl/apache2/yourservercert.pem;sslchain=/etc/ssl/apache2/sub.class1.server.ca.pem;sslkey=/etc/ssl/apache2/yourservercertkey.pem

# For Foswiki version 1.1,  Apache 2.2
LoadModule authn_file_module lib/httpd/mod_authn_file.so
LoadModule authn_dbm_module lib/httpd/mod_authn_dbm.so
LoadModule authn_anon_module lib/httpd/mod_authn_anon.so
LoadModule authn_dbd_module lib/httpd/mod_authn_dbd.so
LoadModule authn_default_module lib/httpd/mod_authn_default.so
LoadModule authn_alias_module lib/httpd/mod_authn_alias.so
LoadModule authz_host_module lib/httpd/mod_authz_host.so
LoadModule authz_groupfile_module lib/httpd/mod_authz_groupfile.so
LoadModule authz_user_module lib/httpd/mod_authz_user.so
LoadModule authz_dbm_module lib/httpd/mod_authz_dbm.so
LoadModule authz_owner_module lib/httpd/mod_authz_owner.so
LoadModule authz_default_module lib/httpd/mod_authz_default.so
LoadModule auth_basic_module lib/httpd/mod_auth_basic.so
LoadModule auth_digest_module lib/httpd/mod_auth_digest.so
LoadModule isapi_module lib/httpd/mod_isapi.so
LoadModule file_cache_module lib/httpd/mod_file_cache.so
LoadModule cache_module lib/httpd/mod_cache.so
LoadModule disk_cache_module lib/httpd/mod_disk_cache.so
LoadModule mem_cache_module lib/httpd/mod_mem_cache.so
LoadModule dbd_module lib/httpd/mod_dbd.so
LoadModule bucketeer_module lib/httpd/mod_bucketeer.so
LoadModule dumpio_module lib/httpd/mod_dumpio.so
LoadModule echo_module lib/httpd/mod_echo.so
LoadModule example_module lib/httpd/mod_example.so
LoadModule case_filter_module lib/httpd/mod_case_filter.so
LoadModule case_filter_in_module lib/httpd/mod_case_filter_in.so
LoadModule reqtimeout_module lib/httpd/mod_reqtimeout.so
LoadModule ext_filter_module lib/httpd/mod_ext_filter.so
LoadModule include_module lib/httpd/mod_include.so
LoadModule filter_module lib/httpd/mod_filter.so
LoadModule substitute_module lib/httpd/mod_substitute.so
LoadModule charset_lite_module lib/httpd/mod_charset_lite.so
LoadModule deflate_module lib/httpd/mod_deflate.so
LoadModule log_config_module lib/httpd/mod_log_config.so
LoadModule log_forensic_module lib/httpd/mod_log_forensic.so
LoadModule logio_module lib/httpd/mod_logio.so
LoadModule env_module lib/httpd/mod_env.so
LoadModule mime_magic_module lib/httpd/mod_mime_magic.so
LoadModule cern_meta_module lib/httpd/mod_cern_meta.so
LoadModule expires_module lib/httpd/mod_expires.so
LoadModule headers_module lib/httpd/mod_headers.so
LoadModule ident_module lib/httpd/mod_ident.so
LoadModule usertrack_module lib/httpd/mod_usertrack.so
LoadModule unique_id_module lib/httpd/mod_unique_id.so
LoadModule setenvif_module lib/httpd/mod_setenvif.so
LoadModule version_module lib/httpd/mod_version.so
LoadModule proxy_module lib/httpd/mod_proxy.so
LoadModule proxy_connect_module lib/httpd/mod_proxy_connect.so
LoadModule proxy_ftp_module lib/httpd/mod_proxy_ftp.so
LoadModule proxy_http_module lib/httpd/mod_proxy_http.so
LoadModule proxy_scgi_module lib/httpd/mod_proxy_scgi.so
LoadModule proxy_ajp_module lib/httpd/mod_proxy_ajp.so
LoadModule proxy_balancer_module lib/httpd/mod_proxy_balancer.so
#LoadModule ssl_module lib/httpd/mod_ssl.so
LoadModule mime_module lib/httpd/mod_mime.so
LoadModule dav_module lib/httpd/mod_dav.so
LoadModule status_module lib/httpd/mod_status.so
LoadModule autoindex_module lib/httpd/mod_autoindex.so
LoadModule asis_module lib/httpd/mod_asis.so
LoadModule info_module lib/httpd/mod_info.so
LoadModule cgi_module lib/httpd/mod_cgi.so
LoadModule cgid_module lib/httpd/mod_cgid.so
LoadModule dav_fs_module lib/httpd/mod_dav_fs.so
LoadModule dav_lock_module lib/httpd/mod_dav_lock.so
LoadModule vhost_alias_module lib/httpd/mod_vhost_alias.so
LoadModule negotiation_module lib/httpd/mod_negotiation.so
LoadModule dir_module lib/httpd/mod_dir.so
LoadModule imagemap_module lib/httpd/mod_imagemap.so
LoadModule actions_module lib/httpd/mod_actions.so
LoadModule speling_module lib/httpd/mod_speling.so
LoadModule userdir_module lib/httpd/mod_userdir.so
LoadModule alias_module lib/httpd/mod_alias.so
LoadModule rewrite_module lib/httpd/mod_rewrite.so

# The Alias defines a url that points to the root of the Foswiki installation.
# The first parameter will be part of the URL to your installation e.g.
# http://my.co.uk/foswiki/bin/view/...
# The second parameter must point to the physical path on your disc.

ScriptAlias matterhorn:8585/Foswiki-2.0.0/bin "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/bin"

# The following Alias is used to access files in the pub directory (attachments etc)
# It must come _after_ the ScriptAlias.
# If short URLs are enabled, and any other local directories or files need to be 
#accessed directly, they
# must also be specified in an Alias statement, and must not conflict with a web 
#name.

Alias matterhorn:8585/Foswiki-2.0.0/pub "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/pub"
Alias matterhorn:8585/Foswiki-2.0.0/robots.txt "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/robots.txt"

#  Rewriting is required for Short URLs, and Attachment redirecting to viewfile
RewriteEngine    on
#RewriteLog "/var/log/apache/rewrite.log"
#RewriteLogLevel 0

# short urls
Alias matterhorn:8585/Foswiki-2.0.0 "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/bin/view"
#RewriteRule ^matterhorn:8585/+Foswiki-2.0.0/+bin/+view/+(.*) 
matterhorn:8585/Foswiki-2.0.0/$1 [L,NE,R]
#RewriteRule ^matterhorn:8585/+Foswiki-2.0.0/+bin/+view$ 
matterhorn:8585/Foswiki-2.0.0/ [L,NE,R]

# This enables access to the documents in the Foswiki root directory

<Directory "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0">
    Order Allow,Deny
    Allow from all
    Deny from env=blockAccess
</Directory>

# This specifies the options on the Foswiki scripts directory. The ExecCGI
# and SetHandler tell apache that it contains scripts. "Allow from all"
# lets any IP address access this URL.
# Note:  If you use SELinux, you also have to "Allow httpd cgi support" in your 
#SELinux policies

<Directory "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/bin">
    AllowOverride None

    Order Allow,Deny
    Allow from all
    Deny from env=blockAccess

    Options +ExecCGI  -FollowSymLinks
    SetHandler cgi-script

    # Password file for Foswiki users
    AuthUserFile "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/data/.htpasswd"
    AuthName 'Enter your WikiName: (First name and last name, no space, no dots, capitalized, e.g. JohnSmith). Cancel to register if you do not have one.'
    AuthType Basic

    # File to return on access control error (e.g. wrong password)
    ErrorDocument 401 matterhorn:8585/Foswiki-2.0.0/System/UserRegistration

    # Limit access to configure to specific IP address(es) and user(s).
    # Make sure configure is not open to the general public.
    # It exposes system details that can help attackers.
    # cf. http://foswiki.org/Support/ProtectingYourConfiguration for details.
<FilesMatch "^(configure)$">
        ErrorDocument 401 default
        SetHandler cgi-script
        
        Satisfy All
    </FilesMatch>

</Directory>

# This sets the options on the pub directory, which contains attachments and
# other files like CSS stylesheets and icons. AllowOverride None stops a
# user installing a .htaccess file that overrides these options.
# Note that files in pub are *not* protected by Foswiki Access Controls,
# so if you want to control access to files attached to topics you need to
# block access to the specific directories same way as the ApacheConfigGenerator
# blocks access to the pub directory of the Trash web
<Directory "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/pub">
    Options None
    Options -FollowSymLinks
    AllowOverride None

    Order Allow,Deny
    Allow from all
    Deny from env=blockAccess
    ErrorDocument 404 matterhorn:8585/Foswiki-2.0.0/bin/viewfile

    # Disable execution of PHP scripts
    #php_admin_flag engine off

   # This line will redefine the mime type for the most common types of scripts
    AddType text/plain .shtml .php .php3 .phtml .phtm .pl .py .cgi
   #
   # add an Expires header that is sufficiently in the future that the browser does not even ask if its uptodate
   # reducing the load on the server significantly
   # IF you can, you should enable this - it _will_ improve your Foswiki experience, even if you set it to under one day.
   # you may need to enable expires_module in your main apache config
   #LoadModule expires_module libexec/httpd/mod_expires.so
   #AddModule mod_expires.c
   #<ifmodule mod_expires.c>
   #  <filesmatch "\.(jpe?g|gif|png|css(\.gz)?|js(\.gz)?|ico)$">
   #       ExpiresActive on
   #       ExpiresDefault "access plus 11 days"
   #   </filesmatch>
   #</ifmodule>
   #
   # Serve pre-compressed versions of .js and .css files, if they exist
   # Some browsers do not handle this correctly, which is why it is disabled by default
   # <FilesMatch "\.(js|css)$">
   #         RewriteEngine on
   #         RewriteCond %{HTTP:Accept-encoding} gzip
   #         RewriteCond %{REQUEST_FILENAME}.gz -f
   #         RewriteRule ^(.*)$ %{REQUEST_URI}.gz [L,QSA]
   # </FilesMatch>
   # <FilesMatch "\.(js|css)\?.*$">
   #         RewriteEngine on
   #         RewriteCond %{HTTP:Accept-encoding} gzip
   #         RewriteCond %{REQUEST_FILENAME}.gz -f
   #         RewriteRule ^([^?]*)\?(.*)$ $1.gz?$2 [L]
   # </FilesMatch>
   # <FilesMatch "\.js\.gz(\?.*)?$">
   #         AddEncoding x-gzip .gz
   #         AddType application/x-javascript .gz
   # </FilesMatch>
   # <FilesMatch "\.css\.gz(\?.*)?$">
   #         AddEncoding x-gzip .gz
   #         AddType text/css .gz
   # </FilesMatch>

</Directory>

# Security note: All other directories should be set so
# that they are *not* visible as URLs, so we set them as =deny from all=.
<Directory "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/data">
    deny from all
</Directory>

<Directory "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/templates">
    deny from all
</Directory>

<Directory "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/lib">
    deny from all
</Directory>

<Directory "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/locale">
    deny from all
</Directory>

<Directory "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/tools">
    deny from all
</Directory>

<Directory "/local/scratch/mondays/httpd/htdoc/Foswiki-2.0.0/working">
    deny from all
</Directory>

# We set an environment variable called blockAccess.
#
# Setting a BrowserMatchNoCase to ^$ is important. It prevents Foswiki from
# including its own topics as URLs and also prevents other Foswikis from
# doing the same. This is important to prevent the most obvious
# Denial of Service attacks.
#
# You can expand this by adding more BrowserMatchNoCase statements to
# block evil browser agents trying to crawl your Foswiki
#
# Example:
# BrowserMatchNoCase ^SiteSucker blockAccess
# BrowserMatchNoCase ^$ blockAccess

BrowserMatchNoCase ^$ blockAccess


